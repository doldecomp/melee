.include "macros.inc"

.section .text  # 0x80005940 - 0x803B7240

.global __CARDGetFatBlock
__CARDGetFatBlock:
/* 803549B8 00351598  80 63 00 88 */	lwz r3, 0x88(r3)
/* 803549BC 0035159C  4E 80 00 20 */	blr 

WriteCallback:
/* 803549C0 003515A0  7C 08 02 A6 */	mflr r0
/* 803549C4 003515A4  90 01 00 04 */	stw r0, 4(r1)
/* 803549C8 003515A8  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 803549CC 003515AC  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 803549D0 003515B0  93 C1 00 18 */	stw r30, 0x18(r1)
/* 803549D4 003515B4  7C 9E 23 79 */	or. r30, r4, r4
/* 803549D8 003515B8  93 A1 00 14 */	stw r29, 0x14(r1)
/* 803549DC 003515BC  3B A3 00 00 */	addi r29, r3, 0
/* 803549E0 003515C0  1C BD 01 10 */	mulli r5, r29, 0x110
/* 803549E4 003515C4  3C 60 80 4B */	lis r3, lbl_804A8B38@ha
/* 803549E8 003515C8  38 03 8B 38 */	addi r0, r3, lbl_804A8B38@l
/* 803549EC 003515CC  7F E0 2A 14 */	add r31, r0, r5
/* 803549F0 003515D0  41 80 00 48 */	blt lbl_80354A38
/* 803549F4 003515D4  80 7F 00 80 */	lwz r3, 0x80(r31)
/* 803549F8 003515D8  80 1F 00 88 */	lwz r0, 0x88(r31)
/* 803549FC 003515DC  38 83 60 00 */	addi r4, r3, 0x6000
/* 80354A00 003515E0  7C 00 20 40 */	cmplw r0, r4
/* 80354A04 003515E4  3C A3 00 01 */	addis r5, r3, 1
/* 80354A08 003515E8  38 A5 80 00 */	addi r5, r5, -32768
/* 80354A0C 003515EC  40 82 00 18 */	bne lbl_80354A24
/* 80354A10 003515F0  90 BF 00 88 */	stw r5, 0x88(r31)
/* 80354A14 003515F4  38 65 00 00 */	addi r3, r5, 0
/* 80354A18 003515F8  38 A0 20 00 */	li r5, 0x2000
/* 80354A1C 003515FC  4B CA E7 D9 */	bl memcpy
/* 80354A20 00351600  48 00 00 18 */	b lbl_80354A38
lbl_80354A24:
/* 80354A24 00351604  90 9F 00 88 */	stw r4, 0x88(r31)
/* 80354A28 00351608  38 64 00 00 */	addi r3, r4, 0
/* 80354A2C 0035160C  38 85 00 00 */	addi r4, r5, 0
/* 80354A30 00351610  38 A0 20 00 */	li r5, 0x2000
/* 80354A34 00351614  4B CA E7 C1 */	bl memcpy
lbl_80354A38:
/* 80354A38 00351618  80 1F 00 D0 */	lwz r0, 0xd0(r31)
/* 80354A3C 0035161C  28 00 00 00 */	cmplwi r0, 0
/* 80354A40 00351620  40 82 00 10 */	bne lbl_80354A50
/* 80354A44 00351624  38 7F 00 00 */	addi r3, r31, 0
/* 80354A48 00351628  38 9E 00 00 */	addi r4, r30, 0
/* 80354A4C 0035162C  4B FF E8 25 */	bl __CARDPutControlBlock
lbl_80354A50:
/* 80354A50 00351630  80 1F 00 D8 */	lwz r0, 0xd8(r31)
/* 80354A54 00351634  28 00 00 00 */	cmplwi r0, 0
/* 80354A58 00351638  7C 0C 03 78 */	mr r12, r0
/* 80354A5C 0035163C  41 82 00 1C */	beq lbl_80354A78
/* 80354A60 00351640  38 00 00 00 */	li r0, 0
/* 80354A64 00351644  7D 88 03 A6 */	mtlr r12
/* 80354A68 00351648  90 1F 00 D8 */	stw r0, 0xd8(r31)
/* 80354A6C 0035164C  38 7D 00 00 */	addi r3, r29, 0
/* 80354A70 00351650  38 9E 00 00 */	addi r4, r30, 0
/* 80354A74 00351654  4E 80 00 21 */	blrl 
lbl_80354A78:
/* 80354A78 00351658  80 01 00 24 */	lwz r0, 0x24(r1)
/* 80354A7C 0035165C  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 80354A80 00351660  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 80354A84 00351664  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 80354A88 00351668  38 21 00 20 */	addi r1, r1, 0x20
/* 80354A8C 0035166C  7C 08 03 A6 */	mtlr r0
/* 80354A90 00351670  4E 80 00 20 */	blr 

EraseCallback:
/* 80354A94 00351674  7C 08 02 A6 */	mflr r0
/* 80354A98 00351678  90 01 00 04 */	stw r0, 4(r1)
/* 80354A9C 0035167C  94 21 FF D8 */	stwu r1, -0x28(r1)
/* 80354AA0 00351680  93 E1 00 24 */	stw r31, 0x24(r1)
/* 80354AA4 00351684  3B E3 00 00 */	addi r31, r3, 0
/* 80354AA8 00351688  3C 60 80 4B */	lis r3, lbl_804A8B38@ha
/* 80354AAC 0035168C  93 C1 00 20 */	stw r30, 0x20(r1)
/* 80354AB0 00351690  1C BF 01 10 */	mulli r5, r31, 0x110
/* 80354AB4 00351694  93 A1 00 1C */	stw r29, 0x1c(r1)
/* 80354AB8 00351698  38 03 8B 38 */	addi r0, r3, lbl_804A8B38@l
/* 80354ABC 0035169C  7C 9D 23 79 */	or. r29, r4, r4
/* 80354AC0 003516A0  7F C0 2A 14 */	add r30, r0, r5
/* 80354AC4 003516A4  41 80 00 3C */	blt lbl_80354B00
/* 80354AC8 003516A8  80 BE 00 88 */	lwz r5, 0x88(r30)
/* 80354ACC 003516AC  3C 60 80 35 */	lis r3, WriteCallback@ha
/* 80354AD0 003516B0  80 1E 00 80 */	lwz r0, 0x80(r30)
/* 80354AD4 003516B4  38 E3 49 C0 */	addi r7, r3, WriteCallback@l
/* 80354AD8 003516B8  80 7E 00 0C */	lwz r3, 0xc(r30)
/* 80354ADC 003516BC  7C 00 28 50 */	subf r0, r0, r5
/* 80354AE0 003516C0  54 00 9B 7E */	srwi r0, r0, 0xd
/* 80354AE4 003516C4  7C 83 01 D6 */	mullw r4, r3, r0
/* 80354AE8 003516C8  38 C5 00 00 */	addi r6, r5, 0
/* 80354AEC 003516CC  38 7F 00 00 */	addi r3, r31, 0
/* 80354AF0 003516D0  38 A0 20 00 */	li r5, 0x2000
/* 80354AF4 003516D4  4B FF FE 49 */	bl func_8035493C
/* 80354AF8 003516D8  7C 7D 1B 79 */	or. r29, r3, r3
/* 80354AFC 003516DC  40 80 00 44 */	bge lbl_80354B40
lbl_80354B00:
/* 80354B00 003516E0  80 1E 00 D0 */	lwz r0, 0xd0(r30)
/* 80354B04 003516E4  28 00 00 00 */	cmplwi r0, 0
/* 80354B08 003516E8  40 82 00 10 */	bne lbl_80354B18
/* 80354B0C 003516EC  38 7E 00 00 */	addi r3, r30, 0
/* 80354B10 003516F0  38 9D 00 00 */	addi r4, r29, 0
/* 80354B14 003516F4  4B FF E7 5D */	bl __CARDPutControlBlock
lbl_80354B18:
/* 80354B18 003516F8  80 1E 00 D8 */	lwz r0, 0xd8(r30)
/* 80354B1C 003516FC  28 00 00 00 */	cmplwi r0, 0
/* 80354B20 00351700  7C 0C 03 78 */	mr r12, r0
/* 80354B24 00351704  41 82 00 1C */	beq lbl_80354B40
/* 80354B28 00351708  38 00 00 00 */	li r0, 0
/* 80354B2C 0035170C  7D 88 03 A6 */	mtlr r12
/* 80354B30 00351710  90 1E 00 D8 */	stw r0, 0xd8(r30)
/* 80354B34 00351714  38 7F 00 00 */	addi r3, r31, 0
/* 80354B38 00351718  38 9D 00 00 */	addi r4, r29, 0
/* 80354B3C 0035171C  4E 80 00 21 */	blrl 
lbl_80354B40:
/* 80354B40 00351720  80 01 00 2C */	lwz r0, 0x2c(r1)
/* 80354B44 00351724  83 E1 00 24 */	lwz r31, 0x24(r1)
/* 80354B48 00351728  83 C1 00 20 */	lwz r30, 0x20(r1)
/* 80354B4C 0035172C  83 A1 00 1C */	lwz r29, 0x1c(r1)
/* 80354B50 00351730  38 21 00 28 */	addi r1, r1, 0x28
/* 80354B54 00351734  7C 08 03 A6 */	mtlr r0
/* 80354B58 00351738  4E 80 00 20 */	blr 

.global __CARDAllocBlock
__CARDAllocBlock:
/* 80354B5C 0035173C  7C 08 02 A6 */	mflr r0
/* 80354B60 00351740  1C E3 01 10 */	mulli r7, r3, 0x110
/* 80354B64 00351744  90 01 00 04 */	stw r0, 4(r1)
/* 80354B68 00351748  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 80354B6C 0035174C  3C C0 80 4B */	lis r6, lbl_804A8B38@ha
/* 80354B70 00351750  38 06 8B 38 */	addi r0, r6, lbl_804A8B38@l
/* 80354B74 00351754  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 80354B78 00351758  7D 20 3A 14 */	add r9, r0, r7
/* 80354B7C 0035175C  93 C1 00 18 */	stw r30, 0x18(r1)
/* 80354B80 00351760  80 09 00 00 */	lwz r0, 0(r9)
/* 80354B84 00351764  2C 00 00 00 */	cmpwi r0, 0
/* 80354B88 00351768  40 82 00 0C */	bne lbl_80354B94
/* 80354B8C 0035176C  38 60 FF FD */	li r3, -3
/* 80354B90 00351770  48 00 00 CC */	b lbl_80354C5C
lbl_80354B94:
/* 80354B94 00351774  81 09 00 88 */	lwz r8, 0x88(r9)
/* 80354B98 00351778  A0 08 00 06 */	lhz r0, 6(r8)
/* 80354B9C 0035177C  7C 00 20 40 */	cmplw r0, r4
/* 80354BA0 00351780  40 80 00 0C */	bge lbl_80354BAC
/* 80354BA4 00351784  38 60 FF F7 */	li r3, -9
/* 80354BA8 00351788  48 00 00 B4 */	b lbl_80354C5C
lbl_80354BAC:
/* 80354BAC 0035178C  7C 04 00 50 */	subf r0, r4, r0
/* 80354BB0 00351790  B0 08 00 06 */	sth r0, 6(r8)
/* 80354BB4 00351794  3C C0 00 01 */	lis r6, 0x0000FFFF@ha
/* 80354BB8 00351798  39 86 FF FF */	addi r12, r6, 0x0000FFFF@l
/* 80354BBC 0035179C  A1 68 00 08 */	lhz r11, 8(r8)
/* 80354BC0 003517A0  38 0C 00 00 */	addi r0, r12, 0
/* 80354BC4 003517A4  3B C0 00 00 */	li r30, 0
/* 80354BC8 003517A8  48 00 00 7C */	b lbl_80354C44
lbl_80354BCC:
/* 80354BCC 003517AC  A1 49 00 10 */	lhz r10, 0x10(r9)
/* 80354BD0 003517B0  3B DE 00 01 */	addi r30, r30, 1
/* 80354BD4 003517B4  57 C6 04 3E */	clrlwi r6, r30, 0x10
/* 80354BD8 003517B8  38 EA FF FB */	addi r7, r10, -5
/* 80354BDC 003517BC  7C 07 30 00 */	cmpw r7, r6
/* 80354BE0 003517C0  40 80 00 0C */	bge lbl_80354BEC
/* 80354BE4 003517C4  38 60 FF FA */	li r3, -6
/* 80354BE8 003517C8  48 00 00 74 */	b lbl_80354C5C
lbl_80354BEC:
/* 80354BEC 003517CC  39 6B 00 01 */	addi r11, r11, 1
/* 80354BF0 003517D0  55 66 04 3E */	clrlwi r6, r11, 0x10
/* 80354BF4 003517D4  28 06 00 05 */	cmplwi r6, 5
/* 80354BF8 003517D8  41 80 00 0C */	blt lbl_80354C04
/* 80354BFC 003517DC  7C 06 50 40 */	cmplw r6, r10
/* 80354C00 003517E0  41 80 00 08 */	blt lbl_80354C08
lbl_80354C04:
/* 80354C04 003517E4  39 60 00 05 */	li r11, 5
lbl_80354C08:
/* 80354C08 003517E8  55 66 0B FC */	rlwinm r6, r11, 1, 0xf, 0x1e
/* 80354C0C 003517EC  7C E8 32 14 */	add r7, r8, r6
/* 80354C10 003517F0  A0 C7 00 00 */	lhz r6, 0(r7)
/* 80354C14 003517F4  28 06 00 00 */	cmplwi r6, 0
/* 80354C18 003517F8  40 82 00 2C */	bne lbl_80354C44
/* 80354C1C 003517FC  55 86 04 3E */	clrlwi r6, r12, 0x10
/* 80354C20 00351800  28 06 FF FF */	cmplwi r6, 0xffff
/* 80354C24 00351804  40 82 00 0C */	bne lbl_80354C30
/* 80354C28 00351808  7D 6C 5B 78 */	mr r12, r11
/* 80354C2C 0035180C  48 00 00 0C */	b lbl_80354C38
lbl_80354C30:
/* 80354C30 00351810  57 E6 0B FC */	rlwinm r6, r31, 1, 0xf, 0x1e
/* 80354C34 00351814  7D 68 33 2E */	sthx r11, r8, r6
lbl_80354C38:
/* 80354C38 00351818  B0 07 00 00 */	sth r0, 0(r7)
/* 80354C3C 0035181C  3B EB 00 00 */	addi r31, r11, 0
/* 80354C40 00351820  38 84 FF FF */	addi r4, r4, -1
lbl_80354C44:
/* 80354C44 00351824  28 04 00 00 */	cmplwi r4, 0
/* 80354C48 00351828  40 82 FF 84 */	bne lbl_80354BCC
/* 80354C4C 0035182C  B1 68 00 08 */	sth r11, 8(r8)
/* 80354C50 00351830  7D 04 43 78 */	mr r4, r8
/* 80354C54 00351834  B1 89 00 BE */	sth r12, 0xbe(r9)
/* 80354C58 00351838  48 00 00 B9 */	bl __CARDUpdateFatBlock
lbl_80354C5C:
/* 80354C5C 0035183C  80 01 00 24 */	lwz r0, 0x24(r1)
/* 80354C60 00351840  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 80354C64 00351844  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 80354C68 00351848  38 21 00 20 */	addi r1, r1, 0x20
/* 80354C6C 0035184C  7C 08 03 A6 */	mtlr r0
/* 80354C70 00351850  4E 80 00 20 */	blr 

.global __CARDFreeBlock
__CARDFreeBlock:
/* 80354C74 00351854  7C 08 02 A6 */	mflr r0
/* 80354C78 00351858  1C E3 01 10 */	mulli r7, r3, 0x110
/* 80354C7C 0035185C  90 01 00 04 */	stw r0, 4(r1)
/* 80354C80 00351860  3C C0 80 4B */	lis r6, lbl_804A8B38@ha
/* 80354C84 00351864  94 21 FF F8 */	stwu r1, -8(r1)
/* 80354C88 00351868  38 06 8B 38 */	addi r0, r6, lbl_804A8B38@l
/* 80354C8C 0035186C  7D 20 3A 14 */	add r9, r0, r7
/* 80354C90 00351870  80 09 00 00 */	lwz r0, 0(r9)
/* 80354C94 00351874  2C 00 00 00 */	cmpwi r0, 0
/* 80354C98 00351878  40 82 00 0C */	bne lbl_80354CA4
/* 80354C9C 0035187C  38 60 FF FD */	li r3, -3
/* 80354CA0 00351880  48 00 00 60 */	b lbl_80354D00
lbl_80354CA4:
/* 80354CA4 00351884  81 09 00 88 */	lwz r8, 0x88(r9)
/* 80354CA8 00351888  38 E0 00 00 */	li r7, 0
/* 80354CAC 0035188C  48 00 00 40 */	b lbl_80354CEC
lbl_80354CB0:
/* 80354CB0 00351890  54 84 04 3E */	clrlwi r4, r4, 0x10
/* 80354CB4 00351894  28 04 00 05 */	cmplwi r4, 5
/* 80354CB8 00351898  41 80 00 10 */	blt lbl_80354CC8
/* 80354CBC 0035189C  A0 09 00 10 */	lhz r0, 0x10(r9)
/* 80354CC0 003518A0  7C 04 00 40 */	cmplw r4, r0
/* 80354CC4 003518A4  41 80 00 0C */	blt lbl_80354CD0
lbl_80354CC8:
/* 80354CC8 003518A8  38 60 FF FA */	li r3, -6
/* 80354CCC 003518AC  48 00 00 34 */	b lbl_80354D00
lbl_80354CD0:
/* 80354CD0 003518B0  54 80 08 3C */	slwi r0, r4, 1
/* 80354CD4 003518B4  7C C8 02 14 */	add r6, r8, r0
/* 80354CD8 003518B8  A0 86 00 00 */	lhz r4, 0(r6)
/* 80354CDC 003518BC  B0 E6 00 00 */	sth r7, 0(r6)
/* 80354CE0 003518C0  A0 C8 00 06 */	lhz r6, 6(r8)
/* 80354CE4 003518C4  38 06 00 01 */	addi r0, r6, 1
/* 80354CE8 003518C8  B0 08 00 06 */	sth r0, 6(r8)
lbl_80354CEC:
/* 80354CEC 003518CC  54 80 04 3E */	clrlwi r0, r4, 0x10
/* 80354CF0 003518D0  28 00 FF FF */	cmplwi r0, 0xffff
/* 80354CF4 003518D4  40 82 FF BC */	bne lbl_80354CB0
/* 80354CF8 003518D8  7D 04 43 78 */	mr r4, r8
/* 80354CFC 003518DC  48 00 00 15 */	bl __CARDUpdateFatBlock
lbl_80354D00:
/* 80354D00 003518E0  80 01 00 0C */	lwz r0, 0xc(r1)
/* 80354D04 003518E4  38 21 00 08 */	addi r1, r1, 8
/* 80354D08 003518E8  7C 08 03 A6 */	mtlr r0
/* 80354D0C 003518EC  4E 80 00 20 */	blr 

.global __CARDUpdateFatBlock
__CARDUpdateFatBlock:
/* 80354D10 003518F0  7C 08 02 A6 */	mflr r0
/* 80354D14 003518F4  90 01 00 04 */	stw r0, 4(r1)
/* 80354D18 003518F8  94 21 FF D8 */	stwu r1, -0x28(r1)
/* 80354D1C 003518FC  93 E1 00 24 */	stw r31, 0x24(r1)
/* 80354D20 00351900  93 C1 00 20 */	stw r30, 0x20(r1)
/* 80354D24 00351904  3B C5 00 00 */	addi r30, r5, 0
/* 80354D28 00351908  93 A1 00 1C */	stw r29, 0x1c(r1)
/* 80354D2C 0035190C  3B A4 00 00 */	addi r29, r4, 0
/* 80354D30 00351910  38 BD 00 00 */	addi r5, r29, 0
/* 80354D34 00351914  93 81 00 18 */	stw r28, 0x18(r1)
/* 80354D38 00351918  3B 83 00 00 */	addi r28, r3, 0
/* 80354D3C 0035191C  38 DD 00 02 */	addi r6, r29, 2
/* 80354D40 00351920  A0 64 00 04 */	lhz r3, 4(r4)
/* 80354D44 00351924  1C 9C 01 10 */	mulli r4, r28, 0x110
/* 80354D48 00351928  38 03 00 01 */	addi r0, r3, 1
/* 80354D4C 0035192C  3C 60 80 4B */	lis r3, lbl_804A8B38@ha
/* 80354D50 00351930  B0 1D 00 04 */	sth r0, 4(r29)
/* 80354D54 00351934  38 03 8B 38 */	addi r0, r3, lbl_804A8B38@l
/* 80354D58 00351938  7F E0 22 14 */	add r31, r0, r4
/* 80354D5C 0035193C  38 7D 00 04 */	addi r3, r29, 4
/* 80354D60 00351940  38 80 1F FC */	li r4, 0x1ffc
/* 80354D64 00351944  48 00 02 BD */	bl __CARDCheckSum
/* 80354D68 00351948  38 7D 00 00 */	addi r3, r29, 0
/* 80354D6C 0035194C  38 80 20 00 */	li r4, 0x2000
/* 80354D70 00351950  4B FE FA D1 */	bl DCStoreRange
/* 80354D74 00351954  93 DF 00 D8 */	stw r30, 0xd8(r31)
/* 80354D78 00351958  3C 60 80 35 */	lis r3, EraseCallback@ha
/* 80354D7C 0035195C  38 A3 4A 94 */	addi r5, r3, EraseCallback@l
/* 80354D80 00351960  80 1F 00 80 */	lwz r0, 0x80(r31)
/* 80354D84 00351964  7F 83 E3 78 */	mr r3, r28
/* 80354D88 00351968  80 9F 00 0C */	lwz r4, 0xc(r31)
/* 80354D8C 0035196C  7C 00 E8 50 */	subf r0, r0, r29
/* 80354D90 00351970  54 00 9B 7E */	srwi r0, r0, 0xd
/* 80354D94 00351974  7C 84 01 D6 */	mullw r4, r4, r0
/* 80354D98 00351978  4B FF E2 6D */	bl __CARDEraseSector
/* 80354D9C 0035197C  80 01 00 2C */	lwz r0, 0x2c(r1)
/* 80354DA0 00351980  83 E1 00 24 */	lwz r31, 0x24(r1)
/* 80354DA4 00351984  83 C1 00 20 */	lwz r30, 0x20(r1)
/* 80354DA8 00351988  83 A1 00 1C */	lwz r29, 0x1c(r1)
/* 80354DAC 0035198C  83 81 00 18 */	lwz r28, 0x18(r1)
/* 80354DB0 00351990  38 21 00 28 */	addi r1, r1, 0x28
/* 80354DB4 00351994  7C 08 03 A6 */	mtlr r0
/* 80354DB8 00351998  4E 80 00 20 */	blr 
