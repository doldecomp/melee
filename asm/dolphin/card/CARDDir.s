.include "macros.inc"

.section .text  # 0x80005940 - 0x803B7240

.global __CARDGetDirBlock
__CARDGetDirBlock:
/* 80354DBC 0035199C  80 63 00 84 */	lwz r3, 0x84(r3)
/* 80354DC0 003519A0  4E 80 00 20 */	blr 

WriteCallback:
/* 80354DC4 003519A4  7C 08 02 A6 */	mflr r0
/* 80354DC8 003519A8  90 01 00 04 */	stw r0, 4(r1)
/* 80354DCC 003519AC  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 80354DD0 003519B0  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 80354DD4 003519B4  93 C1 00 18 */	stw r30, 0x18(r1)
/* 80354DD8 003519B8  7C 9E 23 79 */	or. r30, r4, r4
/* 80354DDC 003519BC  93 A1 00 14 */	stw r29, 0x14(r1)
/* 80354DE0 003519C0  3B A3 00 00 */	addi r29, r3, 0
/* 80354DE4 003519C4  1C BD 01 10 */	mulli r5, r29, 0x110
/* 80354DE8 003519C8  3C 60 80 4B */	lis r3, __CARDBlock@ha
/* 80354DEC 003519CC  38 03 8B 38 */	addi r0, r3, __CARDBlock@l
/* 80354DF0 003519D0  7F E0 2A 14 */	add r31, r0, r5
/* 80354DF4 003519D4  41 80 00 44 */	blt lbl_80354E38
/* 80354DF8 003519D8  80 7F 00 80 */	lwz r3, 0x80(r31)
/* 80354DFC 003519DC  80 1F 00 84 */	lwz r0, 0x84(r31)
/* 80354E00 003519E0  38 83 20 00 */	addi r4, r3, 0x2000
/* 80354E04 003519E4  7C 00 20 40 */	cmplw r0, r4
/* 80354E08 003519E8  38 03 40 00 */	addi r0, r3, 0x4000
/* 80354E0C 003519EC  40 82 00 18 */	bne lbl_80354E24
/* 80354E10 003519F0  90 1F 00 84 */	stw r0, 0x84(r31)
/* 80354E14 003519F4  7C 03 03 78 */	mr r3, r0
/* 80354E18 003519F8  38 A0 20 00 */	li r5, 0x2000
/* 80354E1C 003519FC  4B CA E3 D9 */	bl memcpy
/* 80354E20 00351A00  48 00 00 18 */	b lbl_80354E38
lbl_80354E24:
/* 80354E24 00351A04  90 9F 00 84 */	stw r4, 0x84(r31)
/* 80354E28 00351A08  38 64 00 00 */	addi r3, r4, 0
/* 80354E2C 00351A0C  7C 04 03 78 */	mr r4, r0
/* 80354E30 00351A10  38 A0 20 00 */	li r5, 0x2000
/* 80354E34 00351A14  4B CA E3 C1 */	bl memcpy
lbl_80354E38:
/* 80354E38 00351A18  80 1F 00 D0 */	lwz r0, 0xd0(r31)
/* 80354E3C 00351A1C  28 00 00 00 */	cmplwi r0, 0
/* 80354E40 00351A20  40 82 00 10 */	bne lbl_80354E50
/* 80354E44 00351A24  38 7F 00 00 */	addi r3, r31, 0
/* 80354E48 00351A28  38 9E 00 00 */	addi r4, r30, 0
/* 80354E4C 00351A2C  4B FF E4 25 */	bl __CARDPutControlBlock
lbl_80354E50:
/* 80354E50 00351A30  80 1F 00 D8 */	lwz r0, 0xd8(r31)
/* 80354E54 00351A34  28 00 00 00 */	cmplwi r0, 0
/* 80354E58 00351A38  7C 0C 03 78 */	mr r12, r0
/* 80354E5C 00351A3C  41 82 00 1C */	beq lbl_80354E78
/* 80354E60 00351A40  38 00 00 00 */	li r0, 0
/* 80354E64 00351A44  7D 88 03 A6 */	mtlr r12
/* 80354E68 00351A48  90 1F 00 D8 */	stw r0, 0xd8(r31)
/* 80354E6C 00351A4C  38 7D 00 00 */	addi r3, r29, 0
/* 80354E70 00351A50  38 9E 00 00 */	addi r4, r30, 0
/* 80354E74 00351A54  4E 80 00 21 */	blrl 
lbl_80354E78:
/* 80354E78 00351A58  80 01 00 24 */	lwz r0, 0x24(r1)
/* 80354E7C 00351A5C  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 80354E80 00351A60  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 80354E84 00351A64  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 80354E88 00351A68  38 21 00 20 */	addi r1, r1, 0x20
/* 80354E8C 00351A6C  7C 08 03 A6 */	mtlr r0
/* 80354E90 00351A70  4E 80 00 20 */	blr 

EraseCallback:
/* 80354E94 00351A74  7C 08 02 A6 */	mflr r0
/* 80354E98 00351A78  90 01 00 04 */	stw r0, 4(r1)
/* 80354E9C 00351A7C  94 21 FF D8 */	stwu r1, -0x28(r1)
/* 80354EA0 00351A80  93 E1 00 24 */	stw r31, 0x24(r1)
/* 80354EA4 00351A84  3B E3 00 00 */	addi r31, r3, 0
/* 80354EA8 00351A88  3C 60 80 4B */	lis r3, __CARDBlock@ha
/* 80354EAC 00351A8C  93 C1 00 20 */	stw r30, 0x20(r1)
/* 80354EB0 00351A90  1C BF 01 10 */	mulli r5, r31, 0x110
/* 80354EB4 00351A94  93 A1 00 1C */	stw r29, 0x1c(r1)
/* 80354EB8 00351A98  38 03 8B 38 */	addi r0, r3, __CARDBlock@l
/* 80354EBC 00351A9C  7C 9D 23 79 */	or. r29, r4, r4
/* 80354EC0 00351AA0  7F C0 2A 14 */	add r30, r0, r5
/* 80354EC4 00351AA4  41 80 00 3C */	blt lbl_80354F00
/* 80354EC8 00351AA8  80 BE 00 84 */	lwz r5, 0x84(r30)
/* 80354ECC 00351AAC  3C 60 80 35 */	lis r3, WriteCallback@ha
/* 80354ED0 00351AB0  80 1E 00 80 */	lwz r0, 0x80(r30)
/* 80354ED4 00351AB4  38 E3 4D C4 */	addi r7, r3, WriteCallback@l
/* 80354ED8 00351AB8  80 7E 00 0C */	lwz r3, 0xc(r30)
/* 80354EDC 00351ABC  7C 00 28 50 */	subf r0, r0, r5
/* 80354EE0 00351AC0  54 00 9B 7E */	srwi r0, r0, 0xd
/* 80354EE4 00351AC4  7C 83 01 D6 */	mullw r4, r3, r0
/* 80354EE8 00351AC8  38 C5 00 00 */	addi r6, r5, 0
/* 80354EEC 00351ACC  38 7F 00 00 */	addi r3, r31, 0
/* 80354EF0 00351AD0  38 A0 20 00 */	li r5, 0x2000
/* 80354EF4 00351AD4  4B FF FA 49 */	bl __CARDWrite
/* 80354EF8 00351AD8  7C 7D 1B 79 */	or. r29, r3, r3
/* 80354EFC 00351ADC  40 80 00 44 */	bge lbl_80354F40
lbl_80354F00:
/* 80354F00 00351AE0  80 1E 00 D0 */	lwz r0, 0xd0(r30)
/* 80354F04 00351AE4  28 00 00 00 */	cmplwi r0, 0
/* 80354F08 00351AE8  40 82 00 10 */	bne lbl_80354F18
/* 80354F0C 00351AEC  38 7E 00 00 */	addi r3, r30, 0
/* 80354F10 00351AF0  38 9D 00 00 */	addi r4, r29, 0
/* 80354F14 00351AF4  4B FF E3 5D */	bl __CARDPutControlBlock
lbl_80354F18:
/* 80354F18 00351AF8  80 1E 00 D8 */	lwz r0, 0xd8(r30)
/* 80354F1C 00351AFC  28 00 00 00 */	cmplwi r0, 0
/* 80354F20 00351B00  7C 0C 03 78 */	mr r12, r0
/* 80354F24 00351B04  41 82 00 1C */	beq lbl_80354F40
/* 80354F28 00351B08  38 00 00 00 */	li r0, 0
/* 80354F2C 00351B0C  7D 88 03 A6 */	mtlr r12
/* 80354F30 00351B10  90 1E 00 D8 */	stw r0, 0xd8(r30)
/* 80354F34 00351B14  38 7F 00 00 */	addi r3, r31, 0
/* 80354F38 00351B18  38 9D 00 00 */	addi r4, r29, 0
/* 80354F3C 00351B1C  4E 80 00 21 */	blrl 
lbl_80354F40:
/* 80354F40 00351B20  80 01 00 2C */	lwz r0, 0x2c(r1)
/* 80354F44 00351B24  83 E1 00 24 */	lwz r31, 0x24(r1)
/* 80354F48 00351B28  83 C1 00 20 */	lwz r30, 0x20(r1)
/* 80354F4C 00351B2C  83 A1 00 1C */	lwz r29, 0x1c(r1)
/* 80354F50 00351B30  38 21 00 28 */	addi r1, r1, 0x28
/* 80354F54 00351B34  7C 08 03 A6 */	mtlr r0
/* 80354F58 00351B38  4E 80 00 20 */	blr 

.global __CARDUpdateDir
__CARDUpdateDir:
/* 80354F5C 00351B3C  7C 08 02 A6 */	mflr r0
/* 80354F60 00351B40  90 01 00 04 */	stw r0, 4(r1)
/* 80354F64 00351B44  94 21 FF D8 */	stwu r1, -0x28(r1)
/* 80354F68 00351B48  93 E1 00 24 */	stw r31, 0x24(r1)
/* 80354F6C 00351B4C  93 C1 00 20 */	stw r30, 0x20(r1)
/* 80354F70 00351B50  93 A1 00 1C */	stw r29, 0x1c(r1)
/* 80354F74 00351B54  3B A4 00 00 */	addi r29, r4, 0
/* 80354F78 00351B58  93 81 00 18 */	stw r28, 0x18(r1)
/* 80354F7C 00351B5C  3B 83 00 00 */	addi r28, r3, 0
/* 80354F80 00351B60  1C BC 01 10 */	mulli r5, r28, 0x110
/* 80354F84 00351B64  3C 60 80 4B */	lis r3, __CARDBlock@ha
/* 80354F88 00351B68  38 03 8B 38 */	addi r0, r3, __CARDBlock@l
/* 80354F8C 00351B6C  7F C0 2A 14 */	add r30, r0, r5
/* 80354F90 00351B70  80 1E 00 00 */	lwz r0, 0(r30)
/* 80354F94 00351B74  2C 00 00 00 */	cmpwi r0, 0
/* 80354F98 00351B78  40 82 00 0C */	bne lbl_80354FA4
/* 80354F9C 00351B7C  38 60 FF FD */	li r3, -3
/* 80354FA0 00351B80  48 00 00 60 */	b lbl_80355000
lbl_80354FA4:
/* 80354FA4 00351B84  83 FE 00 84 */	lwz r31, 0x84(r30)
/* 80354FA8 00351B88  38 80 1F FC */	li r4, 0x1ffc
/* 80354FAC 00351B8C  A8 BF 1F FA */	lha r5, 0x1ffa(r31)
/* 80354FB0 00351B90  38 DF 1F C0 */	addi r6, r31, 0x1fc0
/* 80354FB4 00351B94  38 7F 00 00 */	addi r3, r31, 0
/* 80354FB8 00351B98  38 05 00 01 */	addi r0, r5, 1
/* 80354FBC 00351B9C  B0 1F 1F FA */	sth r0, 0x1ffa(r31)
/* 80354FC0 00351BA0  38 A6 00 3C */	addi r5, r6, 0x3c
/* 80354FC4 00351BA4  38 C6 00 3E */	addi r6, r6, 0x3e
/* 80354FC8 00351BA8  48 00 00 59 */	bl __CARDCheckSum
/* 80354FCC 00351BAC  38 7F 00 00 */	addi r3, r31, 0
/* 80354FD0 00351BB0  38 80 20 00 */	li r4, 0x2000
/* 80354FD4 00351BB4  4B FE F8 6D */	bl DCStoreRange
/* 80354FD8 00351BB8  93 BE 00 D8 */	stw r29, 0xd8(r30)
/* 80354FDC 00351BBC  3C 60 80 35 */	lis r3, EraseCallback@ha
/* 80354FE0 00351BC0  38 A3 4E 94 */	addi r5, r3, EraseCallback@l
/* 80354FE4 00351BC4  80 1E 00 80 */	lwz r0, 0x80(r30)
/* 80354FE8 00351BC8  7F 83 E3 78 */	mr r3, r28
/* 80354FEC 00351BCC  80 9E 00 0C */	lwz r4, 0xc(r30)
/* 80354FF0 00351BD0  7C 00 F8 50 */	subf r0, r0, r31
/* 80354FF4 00351BD4  54 00 9B 7E */	srwi r0, r0, 0xd
/* 80354FF8 00351BD8  7C 84 01 D6 */	mullw r4, r4, r0
/* 80354FFC 00351BDC  4B FF E0 09 */	bl __CARDEraseSector
lbl_80355000:
/* 80355000 00351BE0  80 01 00 2C */	lwz r0, 0x2c(r1)
/* 80355004 00351BE4  83 E1 00 24 */	lwz r31, 0x24(r1)
/* 80355008 00351BE8  83 C1 00 20 */	lwz r30, 0x20(r1)
/* 8035500C 00351BEC  83 A1 00 1C */	lwz r29, 0x1c(r1)
/* 80355010 00351BF0  83 81 00 18 */	lwz r28, 0x18(r1)
/* 80355014 00351BF4  38 21 00 28 */	addi r1, r1, 0x28
/* 80355018 00351BF8  7C 08 03 A6 */	mtlr r0
/* 8035501C 00351BFC  4E 80 00 20 */	blr 
