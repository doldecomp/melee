.include "macros.inc"

.section .text  # 0x80005940 - 0x803B7240

.global CARDRenameAsync
CARDRenameAsync:
/* 80358898 00355478  7C 08 02 A6 */	mflr r0
/* 8035889C 0035547C  90 01 00 04 */	stw r0, 4(r1)
/* 803588A0 00355480  94 21 FF B8 */	stwu r1, -0x48(r1)
/* 803588A4 00355484  BE E1 00 24 */	stmw r23, 0x24(r1)
/* 803588A8 00355488  7C 9D 23 78 */	mr r29, r4
/* 803588AC 0035548C  3B 83 00 00 */	addi r28, r3, 0
/* 803588B0 00355490  3B C5 00 00 */	addi r30, r5, 0
/* 803588B4 00355494  3B E6 00 00 */	addi r31, r6, 0
/* 803588B8 00355498  88 84 00 00 */	lbz r4, 0(r4)
/* 803588BC 0035549C  7C 80 07 74 */	extsb r0, r4
/* 803588C0 003554A0  2C 00 00 FF */	cmpwi r0, 0xff
/* 803588C4 003554A4  41 82 00 24 */	beq lbl_803588E8
/* 803588C8 003554A8  88 7E 00 00 */	lbz r3, 0(r30)
/* 803588CC 003554AC  7C 60 07 74 */	extsb r0, r3
/* 803588D0 003554B0  2C 00 00 FF */	cmpwi r0, 0xff
/* 803588D4 003554B4  41 82 00 14 */	beq lbl_803588E8
/* 803588D8 003554B8  7C 80 07 75 */	extsb. r0, r4
/* 803588DC 003554BC  41 82 00 0C */	beq lbl_803588E8
/* 803588E0 003554C0  7C 60 07 75 */	extsb. r0, r3
/* 803588E4 003554C4  40 82 00 0C */	bne lbl_803588F0
lbl_803588E8:
/* 803588E8 003554C8  38 60 FF 80 */	li r3, -128
/* 803588EC 003554CC  48 00 01 94 */	b lbl_80358A80
lbl_803588F0:
/* 803588F0 003554D0  7F A3 EB 78 */	mr r3, r29
/* 803588F4 003554D4  4B FC D2 11 */	bl strlen
/* 803588F8 003554D8  28 03 00 20 */	cmplwi r3, 0x20
/* 803588FC 003554DC  41 81 00 14 */	bgt lbl_80358910
/* 80358900 003554E0  7F C3 F3 78 */	mr r3, r30
/* 80358904 003554E4  4B FC D2 01 */	bl strlen
/* 80358908 003554E8  28 03 00 20 */	cmplwi r3, 0x20
/* 8035890C 003554EC  40 81 00 0C */	ble lbl_80358918
lbl_80358910:
/* 80358910 003554F0  38 60 FF F4 */	li r3, -12
/* 80358914 003554F4  48 00 01 6C */	b lbl_80358A80
lbl_80358918:
/* 80358918 003554F8  38 7C 00 00 */	addi r3, r28, 0
/* 8035891C 003554FC  38 81 00 18 */	addi r4, r1, 0x18
/* 80358920 00355500  4B FF A8 99 */	bl __CARDGetControlBlock
/* 80358924 00355504  2C 03 00 00 */	cmpwi r3, 0
/* 80358928 00355508  40 80 00 08 */	bge lbl_80358930
/* 8035892C 0035550C  48 00 01 54 */	b lbl_80358A80
lbl_80358930:
/* 80358930 00355510  80 61 00 18 */	lwz r3, 0x18(r1)
/* 80358934 00355514  3A E0 FF FF */	li r23, -1
/* 80358938 00355518  3B 00 FF FF */	li r24, -1
/* 8035893C 0035551C  4B FF C4 81 */	bl __CARDGetDirBlock
/* 80358940 00355520  3B 43 00 00 */	addi r26, r3, 0
/* 80358944 00355524  3B 7A 00 00 */	addi r27, r26, 0
/* 80358948 00355528  3B 20 00 00 */	li r25, 0
lbl_8035894C:
/* 8035894C 0035552C  88 1B 00 00 */	lbz r0, 0(r27)
/* 80358950 00355530  28 00 00 FF */	cmplwi r0, 0xff
/* 80358954 00355534  41 82 00 70 */	beq lbl_803589C4
/* 80358958 00355538  80 81 00 18 */	lwz r4, 0x18(r1)
/* 8035895C 0035553C  38 7B 00 00 */	addi r3, r27, 0
/* 80358960 00355540  38 A0 00 04 */	li r5, 4
/* 80358964 00355544  80 84 01 0C */	lwz r4, 0x10c(r4)
/* 80358968 00355548  4B FC AF 61 */	bl memcmp
/* 8035896C 0035554C  2C 03 00 00 */	cmpwi r3, 0
/* 80358970 00355550  40 82 00 54 */	bne lbl_803589C4
/* 80358974 00355554  80 81 00 18 */	lwz r4, 0x18(r1)
/* 80358978 00355558  38 7B 00 04 */	addi r3, r27, 4
/* 8035897C 0035555C  38 A0 00 02 */	li r5, 2
/* 80358980 00355560  80 84 01 0C */	lwz r4, 0x10c(r4)
/* 80358984 00355564  38 84 00 04 */	addi r4, r4, 4
/* 80358988 00355568  4B FC AF 41 */	bl memcmp
/* 8035898C 0035556C  2C 03 00 00 */	cmpwi r3, 0
/* 80358990 00355570  40 82 00 34 */	bne lbl_803589C4
/* 80358994 00355574  38 7B 00 00 */	addi r3, r27, 0
/* 80358998 00355578  38 9D 00 00 */	addi r4, r29, 0
/* 8035899C 0035557C  4B FF E7 B9 */	bl __CARDCompareFileName
/* 803589A0 00355580  2C 03 00 00 */	cmpwi r3, 0
/* 803589A4 00355584  41 82 00 08 */	beq lbl_803589AC
/* 803589A8 00355588  7F 37 CB 78 */	mr r23, r25
lbl_803589AC:
/* 803589AC 0035558C  38 7B 00 00 */	addi r3, r27, 0
/* 803589B0 00355590  38 9E 00 00 */	addi r4, r30, 0
/* 803589B4 00355594  4B FF E7 A1 */	bl __CARDCompareFileName
/* 803589B8 00355598  2C 03 00 00 */	cmpwi r3, 0
/* 803589BC 0035559C  41 82 00 08 */	beq lbl_803589C4
/* 803589C0 003555A0  7F 38 CB 78 */	mr r24, r25
lbl_803589C4:
/* 803589C4 003555A4  3B 39 00 01 */	addi r25, r25, 1
/* 803589C8 003555A8  2C 19 00 7F */	cmpwi r25, 0x7f
/* 803589CC 003555AC  3B 7B 00 40 */	addi r27, r27, 0x40
/* 803589D0 003555B0  41 80 FF 7C */	blt lbl_8035894C
/* 803589D4 003555B4  2C 17 FF FF */	cmpwi r23, -1
/* 803589D8 003555B8  40 82 00 14 */	bne lbl_803589EC
/* 803589DC 003555BC  80 61 00 18 */	lwz r3, 0x18(r1)
/* 803589E0 003555C0  38 80 FF FC */	li r4, -4
/* 803589E4 003555C4  4B FF A8 8D */	bl __CARDPutControlBlock
/* 803589E8 003555C8  48 00 00 98 */	b lbl_80358A80
lbl_803589EC:
/* 803589EC 003555CC  2C 18 FF FF */	cmpwi r24, -1
/* 803589F0 003555D0  41 82 00 14 */	beq lbl_80358A04
/* 803589F4 003555D4  80 61 00 18 */	lwz r3, 0x18(r1)
/* 803589F8 003555D8  38 80 FF F9 */	li r4, -7
/* 803589FC 003555DC  4B FF A8 75 */	bl __CARDPutControlBlock
/* 80358A00 003555E0  48 00 00 80 */	b lbl_80358A80
lbl_80358A04:
/* 80358A04 003555E4  56 E0 30 32 */	slwi r0, r23, 6
/* 80358A08 003555E8  80 61 00 18 */	lwz r3, 0x18(r1)
/* 80358A0C 003555EC  7F 7A 02 14 */	add r27, r26, r0
/* 80358A10 003555F0  38 9B 00 00 */	addi r4, r27, 0
/* 80358A14 003555F4  4B FF E7 A9 */	bl __CARDAccess
/* 80358A18 003555F8  7C 64 1B 79 */	or. r4, r3, r3
/* 80358A1C 003555FC  40 80 00 10 */	bge lbl_80358A2C
/* 80358A20 00355600  80 61 00 18 */	lwz r3, 0x18(r1)
/* 80358A24 00355604  4B FF A8 4D */	bl __CARDPutControlBlock
/* 80358A28 00355608  48 00 00 58 */	b lbl_80358A80
lbl_80358A2C:
/* 80358A2C 0035560C  38 9E 00 00 */	addi r4, r30, 0
/* 80358A30 00355610  38 7B 00 08 */	addi r3, r27, 8
/* 80358A34 00355614  38 A0 00 20 */	li r5, 0x20
/* 80358A38 00355618  4B FC CF D5 */	bl strncpy
/* 80358A3C 0035561C  3C 60 80 00 */	lis r3, 0x800000F8@ha
/* 80358A40 00355620  80 03 00 F8 */	lwz r0, 0x800000F8@l(r3)
/* 80358A44 00355624  54 1D F0 BE */	srwi r29, r0, 2
/* 80358A48 00355628  4B FF 39 A9 */	bl OSGetTime
/* 80358A4C 0035562C  38 DD 00 00 */	addi r6, r29, 0
/* 80358A50 00355630  38 A0 00 00 */	li r5, 0
/* 80358A54 00355634  4B FC 9F B5 */	bl __div2i
/* 80358A58 00355638  90 9B 00 28 */	stw r4, 0x28(r27)
/* 80358A5C 0035563C  38 7C 00 00 */	addi r3, r28, 0
/* 80358A60 00355640  38 9F 00 00 */	addi r4, r31, 0
/* 80358A64 00355644  4B FF C4 F9 */	bl __CARDUpdateDir
/* 80358A68 00355648  7C 7B 1B 79 */	or. r27, r3, r3
/* 80358A6C 0035564C  40 80 00 10 */	bge lbl_80358A7C
/* 80358A70 00355650  80 61 00 18 */	lwz r3, 0x18(r1)
/* 80358A74 00355654  7F 64 DB 78 */	mr r4, r27
/* 80358A78 00355658  4B FF A7 F9 */	bl __CARDPutControlBlock
lbl_80358A7C:
/* 80358A7C 0035565C  7F 63 DB 78 */	mr r3, r27
lbl_80358A80:
/* 80358A80 00355660  BA E1 00 24 */	lmw r23, 0x24(r1)
/* 80358A84 00355664  80 01 00 4C */	lwz r0, 0x4c(r1)
/* 80358A88 00355668  38 21 00 48 */	addi r1, r1, 0x48
/* 80358A8C 0035566C  7C 08 03 A6 */	mtlr r0
/* 80358A90 00355670  4E 80 00 20 */	blr 
