.include "macros.inc"

.section .text  # 0x80005940 - 0x803B7240

.global WriteCallback
WriteCallback:
/* 80357ED0 00354AB0  7C 08 02 A6 */	mflr r0
/* 80357ED4 00354AB4  90 01 00 04 */	stw r0, 4(r1)
/* 80357ED8 00354AB8  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 80357EDC 00354ABC  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 80357EE0 00354AC0  93 C1 00 18 */	stw r30, 0x18(r1)
/* 80357EE4 00354AC4  3B C3 00 00 */	addi r30, r3, 0
/* 80357EE8 00354AC8  3C 60 80 4B */	lis r3, __CARDBlock@ha
/* 80357EEC 00354ACC  93 A1 00 14 */	stw r29, 0x14(r1)
/* 80357EF0 00354AD0  1C BE 01 10 */	mulli r5, r30, 0x110
/* 80357EF4 00354AD4  93 81 00 10 */	stw r28, 0x10(r1)
/* 80357EF8 00354AD8  38 03 8B 38 */	addi r0, r3, __CARDBlock@l
/* 80357EFC 00354ADC  7C 9C 23 79 */	or. r28, r4, r4
/* 80357F00 00354AE0  7F E0 2A 14 */	add r31, r0, r5
/* 80357F04 00354AE4  41 80 00 F0 */	blt lbl_80357FF4
/* 80357F08 00354AE8  83 BF 00 C0 */	lwz r29, 0xc0(r31)
/* 80357F0C 00354AEC  80 7D 00 0C */	lwz r3, 0xc(r29)
/* 80357F10 00354AF0  2C 03 00 00 */	cmpwi r3, 0
/* 80357F14 00354AF4  40 80 00 0C */	bge lbl_80357F20
/* 80357F18 00354AF8  3B 80 FF F2 */	li r28, -14
/* 80357F1C 00354AFC  48 00 00 D8 */	b lbl_80357FF4
lbl_80357F20:
/* 80357F20 00354B00  80 1F 00 0C */	lwz r0, 0xc(r31)
/* 80357F24 00354B04  7C 00 18 50 */	subf r0, r0, r3
/* 80357F28 00354B08  90 1D 00 0C */	stw r0, 0xc(r29)
/* 80357F2C 00354B0C  80 1D 00 0C */	lwz r0, 0xc(r29)
/* 80357F30 00354B10  2C 00 00 00 */	cmpwi r0, 0
/* 80357F34 00354B14  41 81 00 54 */	bgt lbl_80357F88
/* 80357F38 00354B18  7F E3 FB 78 */	mr r3, r31
/* 80357F3C 00354B1C  4B FF CE 81 */	bl __CARDGetDirBlock
/* 80357F40 00354B20  80 BD 00 04 */	lwz r5, 4(r29)
/* 80357F44 00354B24  3C 80 80 00 */	lis r4, 0x800000F8@ha
/* 80357F48 00354B28  80 04 00 F8 */	lwz r0, 0x800000F8@l(r4)
/* 80357F4C 00354B2C  54 A4 30 32 */	slwi r4, r5, 6
/* 80357F50 00354B30  7F 83 22 14 */	add r28, r3, r4
/* 80357F54 00354B34  54 1D F0 BE */	srwi r29, r0, 2
/* 80357F58 00354B38  4B FF 44 99 */	bl OSGetTime
/* 80357F5C 00354B3C  38 DD 00 00 */	addi r6, r29, 0
/* 80357F60 00354B40  38 A0 00 00 */	li r5, 0
/* 80357F64 00354B44  4B FC AA A5 */	bl __div2i
/* 80357F68 00354B48  90 9C 00 28 */	stw r4, 0x28(r28)
/* 80357F6C 00354B4C  38 00 00 00 */	li r0, 0
/* 80357F70 00354B50  38 7E 00 00 */	addi r3, r30, 0
/* 80357F74 00354B54  80 9F 00 D0 */	lwz r4, 0xd0(r31)
/* 80357F78 00354B58  90 1F 00 D0 */	stw r0, 0xd0(r31)
/* 80357F7C 00354B5C  4B FF CF E1 */	bl __CARDUpdateDir
/* 80357F80 00354B60  7C 7C 1B 78 */	mr r28, r3
/* 80357F84 00354B64  48 00 00 68 */	b lbl_80357FEC
lbl_80357F88:
/* 80357F88 00354B68  7F E3 FB 78 */	mr r3, r31
/* 80357F8C 00354B6C  4B FF CA 2D */	bl __CARDGetFatBlock
/* 80357F90 00354B70  80 9D 00 08 */	lwz r4, 8(r29)
/* 80357F94 00354B74  80 1F 00 0C */	lwz r0, 0xc(r31)
/* 80357F98 00354B78  7C 04 02 14 */	add r0, r4, r0
/* 80357F9C 00354B7C  90 1D 00 08 */	stw r0, 8(r29)
/* 80357FA0 00354B80  A0 1D 00 10 */	lhz r0, 0x10(r29)
/* 80357FA4 00354B84  54 00 08 3C */	slwi r0, r0, 1
/* 80357FA8 00354B88  7C 03 02 2E */	lhzx r0, r3, r0
/* 80357FAC 00354B8C  B0 1D 00 10 */	sth r0, 0x10(r29)
/* 80357FB0 00354B90  A0 9D 00 10 */	lhz r4, 0x10(r29)
/* 80357FB4 00354B94  28 04 00 05 */	cmplwi r4, 5
/* 80357FB8 00354B98  41 80 00 10 */	blt lbl_80357FC8
/* 80357FBC 00354B9C  A0 1F 00 10 */	lhz r0, 0x10(r31)
/* 80357FC0 00354BA0  7C 04 00 40 */	cmplw r4, r0
/* 80357FC4 00354BA4  41 80 00 0C */	blt lbl_80357FD0
lbl_80357FC8:
/* 80357FC8 00354BA8  3B 80 FF FA */	li r28, -6
/* 80357FCC 00354BAC  48 00 00 28 */	b lbl_80357FF4
lbl_80357FD0:
/* 80357FD0 00354BB0  80 1F 00 0C */	lwz r0, 0xc(r31)
/* 80357FD4 00354BB4  3C 60 80 36 */	lis r3, EraseCallback@ha
/* 80357FD8 00354BB8  38 A3 80 40 */	addi r5, r3, EraseCallback@l
/* 80357FDC 00354BBC  7C 80 21 D6 */	mullw r4, r0, r4
/* 80357FE0 00354BC0  38 7E 00 00 */	addi r3, r30, 0
/* 80357FE4 00354BC4  4B FF B0 21 */	bl __CARDEraseSector
/* 80357FE8 00354BC8  7C 7C 1B 78 */	mr r28, r3
lbl_80357FEC:
/* 80357FEC 00354BCC  2C 1C 00 00 */	cmpwi r28, 0
/* 80357FF0 00354BD0  40 80 00 30 */	bge lbl_80358020
lbl_80357FF4:
/* 80357FF4 00354BD4  83 BF 00 D0 */	lwz r29, 0xd0(r31)
/* 80357FF8 00354BD8  38 00 00 00 */	li r0, 0
/* 80357FFC 00354BDC  38 7F 00 00 */	addi r3, r31, 0
/* 80358000 00354BE0  90 1F 00 D0 */	stw r0, 0xd0(r31)
/* 80358004 00354BE4  7F 84 E3 78 */	mr r4, r28
/* 80358008 00354BE8  4B FF B2 69 */	bl __CARDPutControlBlock
/* 8035800C 00354BEC  39 9D 00 00 */	addi r12, r29, 0
/* 80358010 00354BF0  7D 88 03 A6 */	mtlr r12
/* 80358014 00354BF4  38 7E 00 00 */	addi r3, r30, 0
/* 80358018 00354BF8  38 9C 00 00 */	addi r4, r28, 0
/* 8035801C 00354BFC  4E 80 00 21 */	blrl 
lbl_80358020:
/* 80358020 00354C00  80 01 00 24 */	lwz r0, 0x24(r1)
/* 80358024 00354C04  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 80358028 00354C08  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 8035802C 00354C0C  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 80358030 00354C10  83 81 00 10 */	lwz r28, 0x10(r1)
/* 80358034 00354C14  38 21 00 20 */	addi r1, r1, 0x20
/* 80358038 00354C18  7C 08 03 A6 */	mtlr r0
/* 8035803C 00354C1C  4E 80 00 20 */	blr 

EraseCallback:
/* 80358040 00354C20  7C 08 02 A6 */	mflr r0
/* 80358044 00354C24  90 01 00 04 */	stw r0, 4(r1)
/* 80358048 00354C28  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 8035804C 00354C2C  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 80358050 00354C30  93 C1 00 18 */	stw r30, 0x18(r1)
/* 80358054 00354C34  93 A1 00 14 */	stw r29, 0x14(r1)
/* 80358058 00354C38  7C 9D 23 79 */	or. r29, r4, r4
/* 8035805C 00354C3C  93 81 00 10 */	stw r28, 0x10(r1)
/* 80358060 00354C40  3B 83 00 00 */	addi r28, r3, 0
/* 80358064 00354C44  1C BC 01 10 */	mulli r5, r28, 0x110
/* 80358068 00354C48  3C 60 80 4B */	lis r3, __CARDBlock@ha
/* 8035806C 00354C4C  38 03 8B 38 */	addi r0, r3, __CARDBlock@l
/* 80358070 00354C50  7F E0 2A 14 */	add r31, r0, r5
/* 80358074 00354C54  41 80 00 30 */	blt lbl_803580A4
/* 80358078 00354C58  80 9F 00 C0 */	lwz r4, 0xc0(r31)
/* 8035807C 00354C5C  3C 60 80 35 */	lis r3, WriteCallback@ha
/* 80358080 00354C60  38 E3 7E D0 */	addi r7, r3, WriteCallback@l
/* 80358084 00354C64  80 BF 00 0C */	lwz r5, 0xc(r31)
/* 80358088 00354C68  A0 04 00 10 */	lhz r0, 0x10(r4)
/* 8035808C 00354C6C  80 DF 00 B4 */	lwz r6, 0xb4(r31)
/* 80358090 00354C70  38 7C 00 00 */	addi r3, r28, 0
/* 80358094 00354C74  7C 85 01 D6 */	mullw r4, r5, r0
/* 80358098 00354C78  4B FF C8 A5 */	bl __CARDWrite
/* 8035809C 00354C7C  7C 7D 1B 79 */	or. r29, r3, r3
/* 803580A0 00354C80  40 80 00 30 */	bge lbl_803580D0
lbl_803580A4:
/* 803580A4 00354C84  83 DF 00 D0 */	lwz r30, 0xd0(r31)
/* 803580A8 00354C88  38 00 00 00 */	li r0, 0
/* 803580AC 00354C8C  38 7F 00 00 */	addi r3, r31, 0
/* 803580B0 00354C90  90 1F 00 D0 */	stw r0, 0xd0(r31)
/* 803580B4 00354C94  7F A4 EB 78 */	mr r4, r29
/* 803580B8 00354C98  4B FF B1 B9 */	bl __CARDPutControlBlock
/* 803580BC 00354C9C  39 9E 00 00 */	addi r12, r30, 0
/* 803580C0 00354CA0  7D 88 03 A6 */	mtlr r12
/* 803580C4 00354CA4  38 7C 00 00 */	addi r3, r28, 0
/* 803580C8 00354CA8  38 9D 00 00 */	addi r4, r29, 0
/* 803580CC 00354CAC  4E 80 00 21 */	blrl 
lbl_803580D0:
/* 803580D0 00354CB0  80 01 00 24 */	lwz r0, 0x24(r1)
/* 803580D4 00354CB4  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 803580D8 00354CB8  83 C1 00 18 */	lwz r30, 0x18(r1)
/* 803580DC 00354CBC  83 A1 00 14 */	lwz r29, 0x14(r1)
/* 803580E0 00354CC0  83 81 00 10 */	lwz r28, 0x10(r1)
/* 803580E4 00354CC4  38 21 00 20 */	addi r1, r1, 0x20
/* 803580E8 00354CC8  7C 08 03 A6 */	mtlr r0
/* 803580EC 00354CCC  4E 80 00 20 */	blr 

.global CARDWriteAsync
CARDWriteAsync:
/* 803580F0 00354CD0  7C 08 02 A6 */	mflr r0
/* 803580F4 00354CD4  90 01 00 04 */	stw r0, 4(r1)
/* 803580F8 00354CD8  94 21 FF C8 */	stwu r1, -0x38(r1)
/* 803580FC 00354CDC  BF 61 00 24 */	stmw r27, 0x24(r1)
/* 80358100 00354CE0  3B 86 00 00 */	addi r28, r6, 0
/* 80358104 00354CE4  3B 65 00 00 */	addi r27, r5, 0
/* 80358108 00354CE8  3B E4 00 00 */	addi r31, r4, 0
/* 8035810C 00354CEC  3B C3 00 00 */	addi r30, r3, 0
/* 80358110 00354CF0  3B A7 00 00 */	addi r29, r7, 0
/* 80358114 00354CF4  38 9B 00 00 */	addi r4, r27, 0
/* 80358118 00354CF8  38 BC 00 00 */	addi r5, r28, 0
/* 8035811C 00354CFC  38 C1 00 1C */	addi r6, r1, 0x1c
/* 80358120 00354D00  4B FF F9 39 */	bl __CARDSeek
/* 80358124 00354D04  2C 03 00 00 */	cmpwi r3, 0
/* 80358128 00354D08  40 80 00 08 */	bge lbl_80358130
/* 8035812C 00354D0C  48 00 00 C4 */	b lbl_803581F0
lbl_80358130:
/* 80358130 00354D10  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 80358134 00354D14  80 83 00 0C */	lwz r4, 0xc(r3)
/* 80358138 00354D18  38 84 FF FF */	addi r4, r4, -1
/* 8035813C 00354D1C  7F 80 20 39 */	and. r0, r28, r4
/* 80358140 00354D20  40 82 00 0C */	bne lbl_8035814C
/* 80358144 00354D24  7F 60 20 39 */	and. r0, r27, r4
/* 80358148 00354D28  41 82 00 10 */	beq lbl_80358158
lbl_8035814C:
/* 8035814C 00354D2C  38 80 FF 80 */	li r4, -128
/* 80358150 00354D30  4B FF B1 21 */	bl __CARDPutControlBlock
/* 80358154 00354D34  48 00 00 9C */	b lbl_803581F0
lbl_80358158:
/* 80358158 00354D38  4B FF CC 65 */	bl __CARDGetDirBlock
/* 8035815C 00354D3C  80 1E 00 04 */	lwz r0, 4(r30)
/* 80358160 00354D40  54 00 30 32 */	slwi r0, r0, 6
/* 80358164 00354D44  7C 83 02 14 */	add r4, r3, r0
/* 80358168 00354D48  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 8035816C 00354D4C  4B FF F0 51 */	bl __CARDAccess
/* 80358170 00354D50  7C 64 1B 79 */	or. r4, r3, r3
/* 80358174 00354D54  40 80 00 10 */	bge lbl_80358184
/* 80358178 00354D58  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 8035817C 00354D5C  4B FF B0 F5 */	bl __CARDPutControlBlock
/* 80358180 00354D60  48 00 00 70 */	b lbl_803581F0
lbl_80358184:
/* 80358184 00354D64  38 7F 00 00 */	addi r3, r31, 0
/* 80358188 00354D68  38 9B 00 00 */	addi r4, r27, 0
/* 8035818C 00354D6C  4B FE C6 B5 */	bl DCStoreRange
/* 80358190 00354D70  28 1D 00 00 */	cmplwi r29, 0
/* 80358194 00354D74  41 82 00 0C */	beq lbl_803581A0
/* 80358198 00354D78  7F A0 EB 78 */	mr r0, r29
/* 8035819C 00354D7C  48 00 00 0C */	b lbl_803581A8
lbl_803581A0:
/* 803581A0 00354D80  3C 60 80 35 */	lis r3, __CARDDefaultApiCallback@ha
/* 803581A4 00354D84  38 03 22 70 */	addi r0, r3, __CARDDefaultApiCallback@l
lbl_803581A8:
/* 803581A8 00354D88  80 81 00 1C */	lwz r4, 0x1c(r1)
/* 803581AC 00354D8C  3C 60 80 36 */	lis r3, EraseCallback@ha
/* 803581B0 00354D90  38 A3 80 40 */	addi r5, r3, EraseCallback@l
/* 803581B4 00354D94  90 04 00 D0 */	stw r0, 0xd0(r4)
/* 803581B8 00354D98  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 803581BC 00354D9C  93 E3 00 B4 */	stw r31, 0xb4(r3)
/* 803581C0 00354DA0  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 803581C4 00354DA4  A0 1E 00 10 */	lhz r0, 0x10(r30)
/* 803581C8 00354DA8  80 83 00 0C */	lwz r4, 0xc(r3)
/* 803581CC 00354DAC  80 7E 00 00 */	lwz r3, 0(r30)
/* 803581D0 00354DB0  7C 84 01 D6 */	mullw r4, r4, r0
/* 803581D4 00354DB4  4B FF AE 31 */	bl __CARDEraseSector
/* 803581D8 00354DB8  7C 7E 1B 79 */	or. r30, r3, r3
/* 803581DC 00354DBC  40 80 00 10 */	bge lbl_803581EC
/* 803581E0 00354DC0  80 61 00 1C */	lwz r3, 0x1c(r1)
/* 803581E4 00354DC4  7F C4 F3 78 */	mr r4, r30
/* 803581E8 00354DC8  4B FF B0 89 */	bl __CARDPutControlBlock
lbl_803581EC:
/* 803581EC 00354DCC  7F C3 F3 78 */	mr r3, r30
lbl_803581F0:
/* 803581F0 00354DD0  BB 61 00 24 */	lmw r27, 0x24(r1)
/* 803581F4 00354DD4  80 01 00 3C */	lwz r0, 0x3c(r1)
/* 803581F8 00354DD8  38 21 00 38 */	addi r1, r1, 0x38
/* 803581FC 00354DDC  7C 08 03 A6 */	mtlr r0
/* 80358200 00354DE0  4E 80 00 20 */	blr 

.global CARDWrite
CARDWrite:
/* 80358204 00354DE4  7C 08 02 A6 */	mflr r0
/* 80358208 00354DE8  3C E0 80 35 */	lis r7, __CARDSyncCallback@ha
/* 8035820C 00354DEC  90 01 00 04 */	stw r0, 4(r1)
/* 80358210 00354DF0  38 E7 22 74 */	addi r7, r7, __CARDSyncCallback@l
/* 80358214 00354DF4  94 21 FF E0 */	stwu r1, -0x20(r1)
/* 80358218 00354DF8  93 E1 00 1C */	stw r31, 0x1c(r1)
/* 8035821C 00354DFC  3B E3 00 00 */	addi r31, r3, 0
/* 80358220 00354E00  4B FF FE D1 */	bl CARDWriteAsync
/* 80358224 00354E04  2C 03 00 00 */	cmpwi r3, 0
/* 80358228 00354E08  40 80 00 08 */	bge lbl_80358230
/* 8035822C 00354E0C  48 00 00 0C */	b lbl_80358238
lbl_80358230:
/* 80358230 00354E10  80 7F 00 00 */	lwz r3, 0(r31)
/* 80358234 00354E14  4B FF B1 F1 */	bl __CARDSync
lbl_80358238:
/* 80358238 00354E18  80 01 00 24 */	lwz r0, 0x24(r1)
/* 8035823C 00354E1C  83 E1 00 1C */	lwz r31, 0x1c(r1)
/* 80358240 00354E20  38 21 00 20 */	addi r1, r1, 0x20
/* 80358244 00354E24  7C 08 03 A6 */	mtlr r0
/* 80358248 00354E28  4E 80 00 20 */	blr 
