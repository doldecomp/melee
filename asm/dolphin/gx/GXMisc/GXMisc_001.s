.include "macros.inc"

.section .text  # 0x80005940 - 0x803B7240

# https://decomp.me/scratch/N6RF9
.global GXSetMisc
GXSetMisc:
/* 8033CBC0 003397A0  2C 03 00 01 */	cmpwi r3, 1
/* 8033CBC4 003397A4  41 82 00 14 */	beq lbl_8033CBD8
/* 8033CBC8 003397A8  4D 80 00 20 */	bltlr 
/* 8033CBCC 003397AC  2C 03 00 03 */	cmpwi r3, 3
/* 8033CBD0 003397B0  4C 80 00 20 */	bgelr 
/* 8033CBD4 003397B4  48 00 00 4C */	b lbl_8033CC20
lbl_8033CBD8:
/* 8033CBD8 003397B8  80 6D A5 08 */	lwz r3, __GXContexts@sda21(r13)
/* 8033CBDC 003397BC  38 00 00 01 */	li r0, 1
/* 8033CBE0 003397C0  B0 83 00 04 */	sth r4, 4(r3)
/* 8033CBE4 003397C4  80 8D A5 08 */	lwz r4, __GXContexts@sda21(r13)
/* 8033CBE8 003397C8  A0 64 00 04 */	lhz r3, 4(r4)
/* 8033CBEC 003397CC  7C 63 00 34 */	cntlzw r3, r3
/* 8033CBF0 003397D0  54 63 DC 3E */	rlwinm r3, r3, 0x1b, 0x10, 0x1f
/* 8033CBF4 003397D4  B0 64 00 00 */	sth r3, 0(r4)
/* 8033CBF8 003397D8  80 6D A5 08 */	lwz r3, __GXContexts@sda21(r13)
/* 8033CBFC 003397DC  B0 03 00 02 */	sth r0, 2(r3)
/* 8033CC00 003397E0  80 6D A5 08 */	lwz r3, __GXContexts@sda21(r13)
/* 8033CC04 003397E4  A0 03 00 04 */	lhz r0, 4(r3)
/* 8033CC08 003397E8  28 00 00 00 */	cmplwi r0, 0
/* 8033CC0C 003397EC  4D 82 00 20 */	beqlr 
/* 8033CC10 003397F0  80 03 04 F0 */	lwz r0, 0x4f0(r3)
/* 8033CC14 003397F4  60 00 00 08 */	ori r0, r0, 8
/* 8033CC18 003397F8  90 03 04 F0 */	stw r0, 0x4f0(r3)
/* 8033CC1C 003397FC  4E 80 00 20 */	blr 
lbl_8033CC20:
/* 8033CC20 00339800  7C 84 00 D0 */	neg r4, r4
/* 8033CC24 00339804  80 6D A5 08 */	lwz r3, __GXContexts@sda21(r13)
/* 8033CC28 00339808  30 04 FF FF */	addic r0, r4, -1
/* 8033CC2C 0033980C  7C 00 21 10 */	subfe r0, r0, r4
/* 8033CC30 00339810  98 03 04 ED */	stb r0, 0x4ed(r3)
/* 8033CC34 00339814  4E 80 00 20 */	blr 

# https://decomp.me/scratch/rSXT0
.global GXSetDrawDone
GXSetDrawDone:
/* 8033CC38 00339818  7C 08 02 A6 */	mflr r0
/* 8033CC3C 0033981C  90 01 00 04 */	stw r0, 4(r1)
/* 8033CC40 00339820  94 21 FF E8 */	stwu r1, -0x18(r1)
/* 8033CC44 00339824  93 E1 00 14 */	stw r31, 0x14(r1)
/* 8033CC48 00339828  93 C1 00 10 */	stw r30, 0x10(r1)
/* 8033CC4C 0033982C  48 00 A7 19 */	bl OSDisableInterrupts
/* 8033CC50 00339830  38 00 00 61 */	li r0, 0x61
/* 8033CC54 00339834  80 8D A5 08 */	lwz r4, __GXContexts@sda21(r13)
/* 8033CC58 00339838  3C C0 CC 01 */	lis r6, 0xCC008000@ha
/* 8033CC5C 0033983C  3C A0 45 00 */	lis r5, 0x45000002@ha
/* 8033CC60 00339840  98 06 80 00 */	stb r0, 0xCC008000@l(r6)
/* 8033CC64 00339844  38 05 00 02 */	addi r0, r5, 0x45000002@l
/* 8033CC68 00339848  90 06 80 00 */	stw r0, -0x8000(r6)
/* 8033CC6C 0033984C  7C 7E 1B 78 */	mr r30, r3
/* 8033CC70 00339850  80 04 04 F0 */	lwz r0, 0x4f0(r4)
/* 8033CC74 00339854  28 00 00 00 */	cmplwi r0, 0
/* 8033CC78 00339858  41 82 00 08 */	beq lbl_8033CC80
/* 8033CC7C 0033985C  48 00 03 D5 */	bl __GXSetDirtyState
lbl_8033CC80:
/* 8033CC80 00339860  3B E0 00 00 */	li r31, 0
/* 8033CC84 00339864  3C 60 CC 01 */	lis r3, 0xCC008000@ha
/* 8033CC88 00339868  93 E3 80 00 */	stw r31, 0xCC008000@l(r3)
/* 8033CC8C 0033986C  93 E3 80 00 */	stw r31, -0x8000(r3)
/* 8033CC90 00339870  93 E3 80 00 */	stw r31, -0x8000(r3)
/* 8033CC94 00339874  93 E3 80 00 */	stw r31, -0x8000(r3)
/* 8033CC98 00339878  93 E3 80 00 */	stw r31, -0x8000(r3)
/* 8033CC9C 0033987C  93 E3 80 00 */	stw r31, -0x8000(r3)
/* 8033CCA0 00339880  93 E3 80 00 */	stw r31, -0x8000(r3)
/* 8033CCA4 00339884  93 E3 80 00 */	stw r31, -0x8000(r3)
/* 8033CCA8 00339888  4B FF 91 E5 */	bl PPCSync
/* 8033CCAC 0033988C  9B ED BC 88 */	stb r31, lbl_804D7328@sda21(r13)
/* 8033CCB0 00339890  7F C3 F3 78 */	mr r3, r30
/* 8033CCB4 00339894  48 00 A6 D9 */	bl OSRestoreInterrupts
/* 8033CCB8 00339898  80 01 00 1C */	lwz r0, 0x1c(r1)
/* 8033CCBC 0033989C  83 E1 00 14 */	lwz r31, 0x14(r1)
/* 8033CCC0 003398A0  83 C1 00 10 */	lwz r30, 0x10(r1)
/* 8033CCC4 003398A4  7C 08 03 A6 */	mtlr r0
/* 8033CCC8 003398A8  38 21 00 18 */	addi r1, r1, 0x18
/* 8033CCCC 003398AC  4E 80 00 20 */	blr 

# https://decomp.me/scratch/B4djd
.global GXWaitDrawDone
GXWaitDrawDone:
/* 8033CCD0 003398B0  7C 08 02 A6 */	mflr r0
/* 8033CCD4 003398B4  90 01 00 04 */	stw r0, 4(r1)
/* 8033CCD8 003398B8  94 21 FF F0 */	stwu r1, -0x10(r1)
/* 8033CCDC 003398BC  93 E1 00 0C */	stw r31, 0xc(r1)
/* 8033CCE0 003398C0  48 00 A6 85 */	bl OSDisableInterrupts
/* 8033CCE4 003398C4  7C 7F 1B 78 */	mr r31, r3
/* 8033CCE8 003398C8  48 00 00 0C */	b lbl_8033CCF4
lbl_8033CCEC:
/* 8033CCEC 003398CC  38 6D BC 8C */	addi r3, r13, GXDrawDoneThreadQueue@sda21
/* 8033CCF0 003398D0  48 00 ED 25 */	bl OSSleepThread
lbl_8033CCF4:
/* 8033CCF4 003398D4  88 0D BC 88 */	lbz r0, lbl_804D7328@sda21(r13)
/* 8033CCF8 003398D8  28 00 00 00 */	cmplwi r0, 0
/* 8033CCFC 003398DC  41 82 FF F0 */	beq lbl_8033CCEC
/* 8033CD00 003398E0  7F E3 FB 78 */	mr r3, r31
/* 8033CD04 003398E4  48 00 A6 89 */	bl OSRestoreInterrupts
/* 8033CD08 003398E8  80 01 00 14 */	lwz r0, 0x14(r1)
/* 8033CD0C 003398EC  83 E1 00 0C */	lwz r31, 0xc(r1)
/* 8033CD10 003398F0  38 21 00 10 */	addi r1, r1, 0x10
/* 8033CD14 003398F4  7C 08 03 A6 */	mtlr r0
/* 8033CD18 003398F8  4E 80 00 20 */	blr 

# https://decomp.me/scratch/cEfhC
.global GXPixModeSync
GXPixModeSync:
/* 8033CD1C 003398FC  38 00 00 61 */	li r0, 0x61
/* 8033CD20 00339900  80 8D A5 08 */	lwz r4, __GXContexts@sda21(r13)
/* 8033CD24 00339904  3C A0 CC 01 */	lis r5, 0xCC008000@ha
/* 8033CD28 00339908  98 05 80 00 */	stb r0, 0xCC008000@l(r5)
/* 8033CD2C 0033990C  38 00 00 00 */	li r0, 0
/* 8033CD30 00339910  80 64 01 DC */	lwz r3, 0x1dc(r4)
/* 8033CD34 00339914  90 65 80 00 */	stw r3, -0x8000(r5)
/* 8033CD38 00339918  B0 04 00 02 */	sth r0, 2(r4)
/* 8033CD3C 0033991C  4E 80 00 20 */	blr 
