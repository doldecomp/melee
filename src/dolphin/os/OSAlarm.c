#include <dolphin/types.h>
#include <dolphin/base/PPCArch.h>
#include <dolphin/os/OSInterrupt.h>

extern unk_t DecrementerExceptionHandler();
extern unk_t AlarmQueue;
extern unk_t __OSSetExceptionHandler();
extern unk_t __OSGetExceptionHandler();
extern unk_t __div2i();
extern unk_t __OSGetSystemTime();

#pragma push
asm unk_t OSInitAlarm()
{ // clang-format off
    nofralloc
/* 80343720 00340300  7C 08 02 A6 */	mflr r0
/* 80343724 00340304  38 60 00 08 */	li r3, 8
/* 80343728 00340308  90 01 00 04 */	stw r0, 4(r1)
/* 8034372C 0034030C  94 21 FF F8 */	stwu r1, -8(r1)
/* 80343730 00340310  4B FF FE A1 */	bl __OSGetExceptionHandler
/* 80343734 00340314  3C 80 80 34 */	lis r4, DecrementerExceptionHandler@ha
/* 80343738 00340318  38 84 3D F8 */	addi r4, r4, DecrementerExceptionHandler@l
/* 8034373C 0034031C  7C 03 20 40 */	cmplw r3, r4
/* 80343740 00340320  41 82 00 1C */	beq lbl_8034375C
/* 80343744 00340324  38 00 00 00 */	li r0, 0
/* 80343748 00340328  38 6D BC B8 */	addi r3, r13, AlarmQueue
/* 8034374C 0034032C  90 03 00 04 */	stw r0, 4(r3)
/* 80343750 00340330  38 60 00 08 */	li r3, 8
/* 80343754 00340334  90 0D BC B8 */	stw r0, AlarmQueue(r13)
/* 80343758 00340338  4B FF FE 5D */	bl __OSSetExceptionHandler
lbl_8034375C:
/* 8034375C 0034033C  80 01 00 0C */	lwz r0, 0xc(r1)
/* 80343760 00340340  38 21 00 08 */	addi r1, r1, 8
/* 80343764 00340344  7C 08 03 A6 */	mtlr r0
/* 80343768 00340348  4E 80 00 20 */	blr 
} // clang-format on
#pragma pop

#pragma push
asm unk_t OSCreateAlarm()
{ // clang-format off
    nofralloc
/* 8034376C 0034034C  38 00 00 00 */	li r0, 0
/* 80343770 00340350  90 03 00 00 */	stw r0, 0(r3)
/* 80343774 00340354  4E 80 00 20 */	blr 
} // clang-format on
#pragma pop



#pragma push
asm unk_t InsertAlarm()
{ // clang-format off
    nofralloc
/* 80343778 00340358  7C 08 02 A6 */	mflr r0
/* 8034377C 0034035C  90 01 00 04 */	stw r0, 4(r1)
/* 80343780 00340360  94 21 FF C0 */	stwu r1, -0x40(r1)
/* 80343784 00340364  BF 21 00 24 */	stmw r25, 0x24(r1)
/* 80343788 00340368  3B 80 00 00 */	li r28, 0
/* 8034378C 0034036C  7C 7D 1B 78 */	mr r29, r3
/* 80343790 00340370  6F 84 80 00 */	xoris r4, r28, 0x8000
/* 80343794 00340374  3B 25 00 00 */	addi r25, r5, 0
/* 80343798 00340378  3B C6 00 00 */	addi r30, r6, 0
/* 8034379C 0034037C  3B E7 00 00 */	addi r31, r7, 0
/* 803437A0 00340380  80 03 00 18 */	lwz r0, 0x18(r3)
/* 803437A4 00340384  81 03 00 1C */	lwz r8, 0x1c(r3)
/* 803437A8 00340388  6C 03 80 00 */	xoris r3, r0, 0x8000
/* 803437AC 0034038C  7C 08 E0 10 */	subfc r0, r8, r28
/* 803437B0 00340390  7C 63 21 10 */	subfe r3, r3, r4
/* 803437B4 00340394  7C 64 21 10 */	subfe r3, r4, r4
/* 803437B8 00340398  7C 63 00 D1 */	neg. r3, r3
/* 803437BC 0034039C  41 82 00 7C */	beq lbl_80343838
/* 803437C0 003403A0  48 00 8C 51 */	bl __OSGetSystemTime
/* 803437C4 003403A4  80 FD 00 20 */	lwz r7, 0x20(r29)
/* 803437C8 003403A8  6C 65 80 00 */	xoris r5, r3, 0x8000
/* 803437CC 003403AC  81 1D 00 24 */	lwz r8, 0x24(r29)
/* 803437D0 003403B0  6C E6 80 00 */	xoris r6, r7, 0x8000
/* 803437D4 003403B4  7C 04 40 10 */	subfc r0, r4, r8
/* 803437D8 003403B8  7C A5 31 10 */	subfe r5, r5, r6
/* 803437DC 003403BC  7C A6 31 10 */	subfe r5, r6, r6
/* 803437E0 003403C0  7C A5 00 D1 */	neg. r5, r5
/* 803437E4 003403C4  3B C8 00 00 */	addi r30, r8, 0
/* 803437E8 003403C8  3B 27 00 00 */	addi r25, r7, 0
/* 803437EC 003403CC  41 82 00 4C */	beq lbl_80343838
/* 803437F0 003403D0  83 7D 00 18 */	lwz r27, 0x18(r29)
/* 803437F4 003403D4  7C 88 20 10 */	subfc r4, r8, r4
/* 803437F8 003403D8  83 5D 00 1C */	lwz r26, 0x1c(r29)
/* 803437FC 003403DC  7C 67 19 10 */	subfe r3, r7, r3
/* 80343800 003403E0  38 BB 00 00 */	addi r5, r27, 0
/* 80343804 003403E4  38 DA 00 00 */	addi r6, r26, 0
/* 80343808 003403E8  4B FD F2 01 */	bl __div2i
/* 8034380C 003403EC  38 00 00 01 */	li r0, 1
/* 80343810 003403F0  7C A4 00 14 */	addc r5, r4, r0
/* 80343814 003403F4  7C 9B 29 D6 */	mullw r4, r27, r5
/* 80343818 003403F8  7C 1A 28 16 */	mulhwu r0, r26, r5
/* 8034381C 003403FC  7C 63 E1 14 */	adde r3, r3, r28
/* 80343820 00340400  7C 84 02 14 */	add r4, r4, r0
/* 80343824 00340404  7C 1A 19 D6 */	mullw r0, r26, r3
/* 80343828 00340408  7C 7A 29 D6 */	mullw r3, r26, r5
/* 8034382C 0034040C  7C 04 02 14 */	add r0, r4, r0
/* 80343830 00340410  7F DE 18 14 */	addc r30, r30, r3
/* 80343834 00340414  7F 39 01 14 */	adde r25, r25, r0
lbl_80343838:
/* 80343838 00340418  93 FD 00 00 */	stw r31, 0(r29)
/* 8034383C 0034041C  6F 24 80 00 */	xoris r4, r25, 0x8000
/* 80343840 00340420  93 DD 00 0C */	stw r30, 0xc(r29)
/* 80343844 00340424  93 3D 00 08 */	stw r25, 8(r29)
/* 80343848 00340428  80 CD BC B8 */	lwz r6, AlarmQueue(r13)
/* 8034384C 0034042C  48 00 00 C4 */	b lbl_80343910
lbl_80343850:
/* 80343850 00340430  80 06 00 08 */	lwz r0, 8(r6)
/* 80343854 00340434  80 A6 00 0C */	lwz r5, 0xc(r6)
/* 80343858 00340438  6C 03 80 00 */	xoris r3, r0, 0x8000
/* 8034385C 0034043C  7C 05 F0 10 */	subfc r0, r5, r30
/* 80343860 00340440  7C 63 21 10 */	subfe r3, r3, r4
/* 80343864 00340444  7C 64 21 10 */	subfe r3, r4, r4
/* 80343868 00340448  7C 63 00 D1 */	neg. r3, r3
/* 8034386C 0034044C  41 82 00 A0 */	beq lbl_8034390C
/* 80343870 00340450  80 06 00 10 */	lwz r0, 0x10(r6)
/* 80343874 00340454  90 1D 00 10 */	stw r0, 0x10(r29)
/* 80343878 00340458  93 A6 00 10 */	stw r29, 0x10(r6)
/* 8034387C 0034045C  90 DD 00 14 */	stw r6, 0x14(r29)
/* 80343880 00340460  80 7D 00 10 */	lwz r3, 0x10(r29)
/* 80343884 00340464  28 03 00 00 */	cmplwi r3, 0
/* 80343888 00340468  41 82 00 0C */	beq lbl_80343894
/* 8034388C 0034046C  93 A3 00 14 */	stw r29, 0x14(r3)
/* 80343890 00340470  48 00 01 24 */	b lbl_803439B4
lbl_80343894:
/* 80343894 00340474  93 AD BC B8 */	stw r29, AlarmQueue(r13)
/* 80343898 00340478  48 00 8B 79 */	bl __OSGetSystemTime
/* 8034389C 0034047C  80 DD 00 0C */	lwz r6, 0xc(r29)
/* 803438A0 00340480  38 E0 00 00 */	li r7, 0
/* 803438A4 00340484  80 1D 00 08 */	lwz r0, 8(r29)
/* 803438A8 00340488  6C E5 80 00 */	xoris r5, r7, 0x8000
/* 803438AC 0034048C  7D 04 30 10 */	subfc r8, r4, r6
/* 803438B0 00340490  7C 03 01 10 */	subfe r0, r3, r0
/* 803438B4 00340494  6C 06 80 00 */	xoris r6, r0, 0x8000
/* 803438B8 00340498  7C 07 40 10 */	subfc r0, r7, r8
/* 803438BC 0034049C  7C A5 31 10 */	subfe r5, r5, r6
/* 803438C0 003404A0  7C A6 31 10 */	subfe r5, r6, r6
/* 803438C4 003404A4  7C A5 00 D1 */	neg. r5, r5
/* 803438C8 003404A8  41 82 00 10 */	beq lbl_803438D8
/* 803438CC 003404AC  38 60 00 00 */	li r3, 0
/* 803438D0 003404B0  4B FF 25 B5 */	bl PPCMtdec
/* 803438D4 003404B4  48 00 00 E0 */	b lbl_803439B4
lbl_803438D8:
/* 803438D8 003404B8  3C 80 80 00 */	lis r4, 0x8000
/* 803438DC 003404BC  6C E3 80 00 */	xoris r3, r7, 0x8000
/* 803438E0 003404C0  7C 04 40 10 */	subfc r0, r4, r8
/* 803438E4 003404C4  7C 63 31 10 */	subfe r3, r3, r6
/* 803438E8 003404C8  7C 66 31 10 */	subfe r3, r6, r6
/* 803438EC 003404CC  7C 63 00 D1 */	neg. r3, r3
/* 803438F0 003404D0  41 82 00 10 */	beq lbl_80343900
/* 803438F4 003404D4  7D 03 43 78 */	mr r3, r8
/* 803438F8 003404D8  4B FF 25 8D */	bl PPCMtdec
/* 803438FC 003404DC  48 00 00 B8 */	b lbl_803439B4
lbl_80343900:
/* 80343900 003404E0  38 64 FF FF */	addi r3, r4, -1
/* 80343904 003404E4  4B FF 25 81 */	bl PPCMtdec
/* 80343908 003404E8  48 00 00 AC */	b lbl_803439B4
lbl_8034390C:
/* 8034390C 003404EC  80 C6 00 14 */	lwz r6, 0x14(r6)
lbl_80343910:
/* 80343910 003404F0  28 06 00 00 */	cmplwi r6, 0
/* 80343914 003404F4  40 82 FF 3C */	bne lbl_80343850
/* 80343918 003404F8  3B C0 00 00 */	li r30, 0
/* 8034391C 003404FC  93 DD 00 14 */	stw r30, 0x14(r29)
/* 80343920 00340500  38 6D BC B8 */	addi r3, r13, AlarmQueue
/* 80343924 00340504  80 83 00 04 */	lwz r4, 4(r3)
/* 80343928 00340508  97 A3 00 04 */	stwu r29, 4(r3)
/* 8034392C 0034050C  28 04 00 00 */	cmplwi r4, 0
/* 80343930 00340510  90 9D 00 10 */	stw r4, 0x10(r29)
/* 80343934 00340514  41 82 00 0C */	beq lbl_80343940
/* 80343938 00340518  93 A4 00 14 */	stw r29, 0x14(r4)
/* 8034393C 0034051C  48 00 00 78 */	b lbl_803439B4
lbl_80343940:
/* 80343940 00340520  93 A3 00 00 */	stw r29, 0(r3)
/* 80343944 00340524  93 AD BC B8 */	stw r29, AlarmQueue(r13)
/* 80343948 00340528  48 00 8A C9 */	bl __OSGetSystemTime
/* 8034394C 0034052C  80 DD 00 0C */	lwz r6, 0xc(r29)
/* 80343950 00340530  6F C5 80 00 */	xoris r5, r30, 0x8000
/* 80343954 00340534  80 1D 00 08 */	lwz r0, 8(r29)
/* 80343958 00340538  7C E4 30 10 */	subfc r7, r4, r6
/* 8034395C 0034053C  7C 03 01 10 */	subfe r0, r3, r0
/* 80343960 00340540  6C 06 80 00 */	xoris r6, r0, 0x8000
/* 80343964 00340544  7C 1E 38 10 */	subfc r0, r30, r7
/* 80343968 00340548  7C A5 31 10 */	subfe r5, r5, r6
/* 8034396C 0034054C  7C A6 31 10 */	subfe r5, r6, r6
/* 80343970 00340550  7C A5 00 D1 */	neg. r5, r5
/* 80343974 00340554  41 82 00 10 */	beq lbl_80343984
/* 80343978 00340558  38 60 00 00 */	li r3, 0
/* 8034397C 0034055C  4B FF 25 09 */	bl PPCMtdec
/* 80343980 00340560  48 00 00 34 */	b lbl_803439B4
lbl_80343984:
/* 80343984 00340564  3C 80 80 00 */	lis r4, 0x8000
/* 80343988 00340568  6F C3 80 00 */	xoris r3, r30, 0x8000
/* 8034398C 0034056C  7C 04 38 10 */	subfc r0, r4, r7
/* 80343990 00340570  7C 63 31 10 */	subfe r3, r3, r6
/* 80343994 00340574  7C 66 31 10 */	subfe r3, r6, r6
/* 80343998 00340578  7C 63 00 D1 */	neg. r3, r3
/* 8034399C 0034057C  41 82 00 10 */	beq lbl_803439AC
/* 803439A0 00340580  7C E3 3B 78 */	mr r3, r7
/* 803439A4 00340584  4B FF 24 E1 */	bl PPCMtdec
/* 803439A8 00340588  48 00 00 0C */	b lbl_803439B4
lbl_803439AC:
/* 803439AC 0034058C  38 64 FF FF */	addi r3, r4, -1
/* 803439B0 00340590  4B FF 24 D5 */	bl PPCMtdec
lbl_803439B4:
/* 803439B4 00340594  BB 21 00 24 */	lmw r25, 0x24(r1)
/* 803439B8 00340598  80 01 00 44 */	lwz r0, 0x44(r1)
/* 803439BC 0034059C  38 21 00 40 */	addi r1, r1, 0x40
/* 803439C0 003405A0  7C 08 03 A6 */	mtlr r0
/* 803439C4 003405A4  4E 80 00 20 */	blr 
} // clang-format on
#pragma pop

#pragma push
asm unk_t OSSetAlarm()
{ // clang-format off
    nofralloc
/* 803439C8 003405A8  7C 08 02 A6 */	mflr r0
/* 803439CC 003405AC  90 01 00 04 */	stw r0, 4(r1)
/* 803439D0 003405B0  94 21 FF C8 */	stwu r1, -0x38(r1)
/* 803439D4 003405B4  BF 61 00 24 */	stmw r27, 0x24(r1)
/* 803439D8 003405B8  3B 63 00 00 */	addi r27, r3, 0
/* 803439DC 003405BC  3B A5 00 00 */	addi r29, r5, 0
/* 803439E0 003405C0  3B 86 00 00 */	addi r28, r6, 0
/* 803439E4 003405C4  3B C7 00 00 */	addi r30, r7, 0
/* 803439E8 003405C8  48 00 39 7D */	bl OSDisableInterrupts
/* 803439EC 003405CC  38 00 00 00 */	li r0, 0
/* 803439F0 003405D0  90 1B 00 1C */	stw r0, 0x1c(r27)
/* 803439F4 003405D4  7C 7F 1B 78 */	mr r31, r3
/* 803439F8 003405D8  90 1B 00 18 */	stw r0, 0x18(r27)
/* 803439FC 003405DC  48 00 8A 15 */	bl __OSGetSystemTime
/* 80343A00 003405E0  7C DC 20 14 */	addc r6, r28, r4
/* 80343A04 003405E4  7C BD 19 14 */	adde r5, r29, r3
/* 80343A08 003405E8  38 7B 00 00 */	addi r3, r27, 0
/* 80343A0C 003405EC  38 FE 00 00 */	addi r7, r30, 0
/* 80343A10 003405F0  4B FF FD 69 */	bl InsertAlarm
/* 80343A14 003405F4  7F E3 FB 78 */	mr r3, r31
/* 80343A18 003405F8  48 00 39 75 */	bl OSRestoreInterrupts
/* 80343A1C 003405FC  BB 61 00 24 */	lmw r27, 0x24(r1)
/* 80343A20 00340600  80 01 00 3C */	lwz r0, 0x3c(r1)
/* 80343A24 00340604  38 21 00 38 */	addi r1, r1, 0x38
/* 80343A28 00340608  7C 08 03 A6 */	mtlr r0
/* 80343A2C 0034060C  4E 80 00 20 */	blr 
} // clang-format on
#pragma pop

extern unk_t __OSTimeToSystemTime();

#pragma push
asm unk_t func_80343A30()
{ // clang-format off
    nofralloc
/* 80343A30 00340610  7C 08 02 A6 */	mflr r0
/* 80343A34 00340614  90 01 00 04 */	stw r0, 4(r1)
/* 80343A38 00340618  94 21 FF C0 */	stwu r1, -0x40(r1)
/* 80343A3C 0034061C  BF 41 00 28 */	stmw r26, 0x28(r1)
/* 80343A40 00340620  3B 43 00 00 */	addi r26, r3, 0
/* 80343A44 00340624  3B 85 00 00 */	addi r28, r5, 0
/* 80343A48 00340628  3B 66 00 00 */	addi r27, r6, 0
/* 80343A4C 0034062C  3B A7 00 00 */	addi r29, r7, 0
/* 80343A50 00340630  3B E8 00 00 */	addi r31, r8, 0
/* 80343A54 00340634  3B C9 00 00 */	addi r30, r9, 0
/* 80343A58 00340638  48 00 39 0D */	bl OSDisableInterrupts
/* 80343A5C 0034063C  93 FA 00 1C */	stw r31, 0x1c(r26)
/* 80343A60 00340640  7C 7F 1B 78 */	mr r31, r3
/* 80343A64 00340644  38 9B 00 00 */	addi r4, r27, 0
/* 80343A68 00340648  93 BA 00 18 */	stw r29, 0x18(r26)
/* 80343A6C 0034064C  38 7C 00 00 */	addi r3, r28, 0
/* 80343A70 00340650  48 00 8A 05 */	bl __OSTimeToSystemTime
/* 80343A74 00340654  90 9A 00 24 */	stw r4, 0x24(r26)
/* 80343A78 00340658  38 FE 00 00 */	addi r7, r30, 0
/* 80343A7C 0034065C  38 C0 00 00 */	li r6, 0
/* 80343A80 00340660  90 7A 00 20 */	stw r3, 0x20(r26)
/* 80343A84 00340664  38 7A 00 00 */	addi r3, r26, 0
/* 80343A88 00340668  38 A0 00 00 */	li r5, 0
/* 80343A8C 0034066C  4B FF FC ED */	bl InsertAlarm
/* 80343A90 00340670  7F E3 FB 78 */	mr r3, r31
/* 80343A94 00340674  48 00 38 F9 */	bl OSRestoreInterrupts
/* 80343A98 00340678  BB 41 00 28 */	lmw r26, 0x28(r1)
/* 80343A9C 0034067C  80 01 00 44 */	lwz r0, 0x44(r1)
/* 80343AA0 00340680  38 21 00 40 */	addi r1, r1, 0x40
/* 80343AA4 00340684  7C 08 03 A6 */	mtlr r0
/* 80343AA8 00340688  4E 80 00 20 */	blr 
} // clang-format on
#pragma pop


