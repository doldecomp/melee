#include <dolphin/types.h>

extern unk_t lbl_804A7D60;
extern unk_t WriteSram();

#pragma push
asm unk_t WriteSramCallback()
{ // clang-format off
    nofralloc
/* 80348A90 00345670  7C 08 02 A6 */	mflr r0
/* 80348A94 00345674  3C 60 80 4A */	lis r3, lbl_804A7D60@ha
/* 80348A98 00345678  90 01 00 04 */	stw r0, 4(r1)
/* 80348A9C 0034567C  94 21 FF E8 */	stwu r1, -0x18(r1)
/* 80348AA0 00345680  93 E1 00 14 */	stw r31, 0x14(r1)
/* 80348AA4 00345684  3B E3 7D 60 */	addi r31, r3, lbl_804A7D60@l
/* 80348AA8 00345688  93 C1 00 10 */	stw r30, 0x10(r1)
/* 80348AAC 0034568C  3B DF 00 40 */	addi r30, r31, 0x40
/* 80348AB0 00345690  80 9F 00 40 */	lwz r4, 0x40(r31)
/* 80348AB4 00345694  7C 7F 22 14 */	add r3, r31, r4
/* 80348AB8 00345698  20 A4 00 40 */	subfic r5, r4, 0x40
/* 80348ABC 0034569C  48 00 00 35 */	bl WriteSram
/* 80348AC0 003456A0  90 7F 00 4C */	stw r3, 0x4c(r31)
/* 80348AC4 003456A4  80 1F 00 4C */	lwz r0, 0x4c(r31)
/* 80348AC8 003456A8  2C 00 00 00 */	cmpwi r0, 0
/* 80348ACC 003456AC  41 82 00 0C */	beq lbl_80348AD8
/* 80348AD0 003456B0  38 00 00 40 */	li r0, 0x40
/* 80348AD4 003456B4  90 1E 00 00 */	stw r0, 0(r30)
lbl_80348AD8:
/* 80348AD8 003456B8  80 01 00 1C */	lwz r0, 0x1c(r1)
/* 80348ADC 003456BC  83 E1 00 14 */	lwz r31, 0x14(r1)
/* 80348AE0 003456C0  83 C1 00 10 */	lwz r30, 0x10(r1)
/* 80348AE4 003456C4  7C 08 03 A6 */	mtlr r0
/* 80348AE8 003456C8  38 21 00 18 */	addi r1, r1, 0x18
/* 80348AEC 003456CC  4E 80 00 20 */	blr 
} // clang-format on
#pragma pop

extern unk_t EXIDeselect();
extern unk_t EXIImmEx();
extern unk_t EXISync();
extern unk_t EXIImm();
extern unk_t EXIUnlock();
extern unk_t EXISelect();
extern unk_t EXILock();

#pragma push
asm unk_t WriteSram()
{ // clang-format off
    nofralloc
/* 80348AF0 003456D0  7C 08 02 A6 */	mflr r0
/* 80348AF4 003456D4  3C C0 80 35 */	lis r6, WriteSramCallback@ha
/* 80348AF8 003456D8  90 01 00 04 */	stw r0, 4(r1)
/* 80348AFC 003456DC  38 06 8A 90 */	addi r0, r6, WriteSramCallback@l
/* 80348B00 003456E0  94 21 FF D8 */	stwu r1, -0x28(r1)
/* 80348B04 003456E4  93 E1 00 24 */	stw r31, 0x24(r1)
/* 80348B08 003456E8  3B E4 00 00 */	addi r31, r4, 0
/* 80348B0C 003456EC  38 80 00 01 */	li r4, 1
/* 80348B10 003456F0  93 C1 00 20 */	stw r30, 0x20(r1)
/* 80348B14 003456F4  3B C5 00 00 */	addi r30, r5, 0
/* 80348B18 003456F8  7C 05 03 78 */	mr r5, r0
/* 80348B1C 003456FC  93 A1 00 1C */	stw r29, 0x1c(r1)
/* 80348B20 00345700  3B A3 00 00 */	addi r29, r3, 0
/* 80348B24 00345704  38 60 00 00 */	li r3, 0
/* 80348B28 00345708  4B FF E2 59 */	bl EXILock
/* 80348B2C 0034570C  2C 03 00 00 */	cmpwi r3, 0
/* 80348B30 00345710  40 82 00 0C */	bne lbl_80348B3C
/* 80348B34 00345714  38 60 00 00 */	li r3, 0
/* 80348B38 00345718  48 00 00 B4 */	b lbl_80348BEC
lbl_80348B3C:
/* 80348B3C 0034571C  38 60 00 00 */	li r3, 0
/* 80348B40 00345720  38 80 00 01 */	li r4, 1
/* 80348B44 00345724  38 A0 00 03 */	li r5, 3
/* 80348B48 00345728  4B FF DB 41 */	bl EXISelect
/* 80348B4C 0034572C  2C 03 00 00 */	cmpwi r3, 0
/* 80348B50 00345730  40 82 00 14 */	bne lbl_80348B64
/* 80348B54 00345734  38 60 00 00 */	li r3, 0
/* 80348B58 00345738  4B FF E3 1D */	bl EXIUnlock
/* 80348B5C 0034573C  38 60 00 00 */	li r3, 0
/* 80348B60 00345740  48 00 00 8C */	b lbl_80348BEC
lbl_80348B64:
/* 80348B64 00345744  57 FF 30 32 */	slwi r31, r31, 6
/* 80348B68 00345748  38 1F 01 00 */	addi r0, r31, 0x100
/* 80348B6C 0034574C  64 00 A0 00 */	oris r0, r0, 0xa000
/* 80348B70 00345750  90 01 00 14 */	stw r0, 0x14(r1)
/* 80348B74 00345754  38 81 00 14 */	addi r4, r1, 0x14
/* 80348B78 00345758  38 60 00 00 */	li r3, 0
/* 80348B7C 0034575C  38 A0 00 04 */	li r5, 4
/* 80348B80 00345760  38 C0 00 01 */	li r6, 1
/* 80348B84 00345764  38 E0 00 00 */	li r7, 0
/* 80348B88 00345768  4B FF CF DD */	bl EXIImm
/* 80348B8C 0034576C  7C 60 00 34 */	cntlzw r0, r3
/* 80348B90 00345770  54 1F D9 7E */	srwi r31, r0, 5
/* 80348B94 00345774  38 60 00 00 */	li r3, 0
/* 80348B98 00345778  4B FF D3 B5 */	bl EXISync
/* 80348B9C 0034577C  7C 60 00 34 */	cntlzw r0, r3
/* 80348BA0 00345780  54 00 D9 7E */	srwi r0, r0, 5
/* 80348BA4 00345784  38 9D 00 00 */	addi r4, r29, 0
/* 80348BA8 00345788  38 BE 00 00 */	addi r5, r30, 0
/* 80348BAC 0034578C  7F FF 03 78 */	or r31, r31, r0
/* 80348BB0 00345790  38 60 00 00 */	li r3, 0
/* 80348BB4 00345794  38 C0 00 01 */	li r6, 1
/* 80348BB8 00345798  4B FF D2 09 */	bl EXIImmEx
/* 80348BBC 0034579C  7C 60 00 34 */	cntlzw r0, r3
/* 80348BC0 003457A0  54 00 D9 7E */	srwi r0, r0, 5
/* 80348BC4 003457A4  7F FF 03 78 */	or r31, r31, r0
/* 80348BC8 003457A8  38 60 00 00 */	li r3, 0
/* 80348BCC 003457AC  4B FF DB E9 */	bl EXIDeselect
/* 80348BD0 003457B0  7C 60 00 34 */	cntlzw r0, r3
/* 80348BD4 003457B4  54 00 D9 7E */	srwi r0, r0, 5
/* 80348BD8 003457B8  7F FF 03 78 */	or r31, r31, r0
/* 80348BDC 003457BC  38 60 00 00 */	li r3, 0
/* 80348BE0 003457C0  4B FF E2 95 */	bl EXIUnlock
/* 80348BE4 003457C4  7F E0 00 34 */	cntlzw r0, r31
/* 80348BE8 003457C8  54 03 D9 7E */	srwi r3, r0, 5
lbl_80348BEC:
/* 80348BEC 003457CC  80 01 00 2C */	lwz r0, 0x2c(r1)
/* 80348BF0 003457D0  83 E1 00 24 */	lwz r31, 0x24(r1)
/* 80348BF4 003457D4  83 C1 00 20 */	lwz r30, 0x20(r1)
/* 80348BF8 003457D8  7C 08 03 A6 */	mtlr r0
/* 80348BFC 003457DC  83 A1 00 1C */	lwz r29, 0x1c(r1)
/* 80348C00 003457E0  38 21 00 28 */	addi r1, r1, 0x28
/* 80348C04 003457E4  4E 80 00 20 */	blr 
} // clang-format on
#pragma pop

extern unk_t EXIDma();
extern unk_t DCInvalidateRange();

#pragma push
asm unk_t __OSInitSram()
{ // clang-format off
    nofralloc
/* 80348C08 003457E8  7C 08 02 A6 */	mflr r0
/* 80348C0C 003457EC  3C 60 80 4A */	lis r3, lbl_804A7D60@ha
/* 80348C10 003457F0  90 01 00 04 */	stw r0, 4(r1)
/* 80348C14 003457F4  38 80 00 40 */	li r4, 0x40
/* 80348C18 003457F8  94 21 FF E8 */	stwu r1, -0x18(r1)
/* 80348C1C 003457FC  93 E1 00 14 */	stw r31, 0x14(r1)
/* 80348C20 00345800  3B E0 00 00 */	li r31, 0
/* 80348C24 00345804  93 C1 00 10 */	stw r30, 0x10(r1)
/* 80348C28 00345808  3B C3 7D 60 */	addi r30, r3, lbl_804A7D60@l
/* 80348C2C 0034580C  38 7E 00 00 */	addi r3, r30, 0
/* 80348C30 00345810  93 FE 00 44 */	stw r31, 0x44(r30)
/* 80348C34 00345814  93 FE 00 48 */	stw r31, 0x48(r30)
/* 80348C38 00345818  4B FF BB A5 */	bl DCInvalidateRange
/* 80348C3C 0034581C  38 60 00 00 */	li r3, 0
/* 80348C40 00345820  38 80 00 01 */	li r4, 1
/* 80348C44 00345824  38 A0 00 00 */	li r5, 0
/* 80348C48 00345828  4B FF E1 39 */	bl EXILock
/* 80348C4C 0034582C  2C 03 00 00 */	cmpwi r3, 0
/* 80348C50 00345830  40 82 00 08 */	bne lbl_80348C58
/* 80348C54 00345834  48 00 00 C4 */	b lbl_80348D18
lbl_80348C58:
/* 80348C58 00345838  38 60 00 00 */	li r3, 0
/* 80348C5C 0034583C  38 80 00 01 */	li r4, 1
/* 80348C60 00345840  38 A0 00 03 */	li r5, 3
/* 80348C64 00345844  4B FF DA 25 */	bl EXISelect
/* 80348C68 00345848  2C 03 00 00 */	cmpwi r3, 0
/* 80348C6C 0034584C  40 82 00 10 */	bne lbl_80348C7C
/* 80348C70 00345850  38 60 00 00 */	li r3, 0
/* 80348C74 00345854  4B FF E2 01 */	bl EXIUnlock
/* 80348C78 00345858  48 00 00 A0 */	b lbl_80348D18
lbl_80348C7C:
/* 80348C7C 0034585C  3C 60 20 00 */	lis r3, 0x20000100@ha
/* 80348C80 00345860  38 03 01 00 */	addi r0, r3, 0x20000100@l
/* 80348C84 00345864  90 01 00 08 */	stw r0, 8(r1)
/* 80348C88 00345868  38 81 00 08 */	addi r4, r1, 8
/* 80348C8C 0034586C  38 60 00 00 */	li r3, 0
/* 80348C90 00345870  38 A0 00 04 */	li r5, 4
/* 80348C94 00345874  38 C0 00 01 */	li r6, 1
/* 80348C98 00345878  38 E0 00 00 */	li r7, 0
/* 80348C9C 0034587C  4B FF CE C9 */	bl EXIImm
/* 80348CA0 00345880  7C 60 00 34 */	cntlzw r0, r3
/* 80348CA4 00345884  54 1F D9 7E */	srwi r31, r0, 5
/* 80348CA8 00345888  38 60 00 00 */	li r3, 0
/* 80348CAC 0034588C  4B FF D2 A1 */	bl EXISync
/* 80348CB0 00345890  7C 60 00 34 */	cntlzw r0, r3
/* 80348CB4 00345894  54 00 D9 7E */	srwi r0, r0, 5
/* 80348CB8 00345898  38 9E 00 00 */	addi r4, r30, 0
/* 80348CBC 0034589C  7F FF 03 78 */	or r31, r31, r0
/* 80348CC0 003458A0  38 60 00 00 */	li r3, 0
/* 80348CC4 003458A4  38 A0 00 40 */	li r5, 0x40
/* 80348CC8 003458A8  38 C0 00 00 */	li r6, 0
/* 80348CCC 003458AC  38 E0 00 00 */	li r7, 0
/* 80348CD0 003458B0  4B FF D1 91 */	bl EXIDma
/* 80348CD4 003458B4  7C 60 00 34 */	cntlzw r0, r3
/* 80348CD8 003458B8  54 00 D9 7E */	srwi r0, r0, 5
/* 80348CDC 003458BC  7F FF 03 78 */	or r31, r31, r0
/* 80348CE0 003458C0  38 60 00 00 */	li r3, 0
/* 80348CE4 003458C4  4B FF D2 69 */	bl EXISync
/* 80348CE8 003458C8  7C 60 00 34 */	cntlzw r0, r3
/* 80348CEC 003458CC  54 00 D9 7E */	srwi r0, r0, 5
/* 80348CF0 003458D0  7F FF 03 78 */	or r31, r31, r0
/* 80348CF4 003458D4  38 60 00 00 */	li r3, 0
/* 80348CF8 003458D8  4B FF DA BD */	bl EXIDeselect
/* 80348CFC 003458DC  7C 60 00 34 */	cntlzw r0, r3
/* 80348D00 003458E0  54 00 D9 7E */	srwi r0, r0, 5
/* 80348D04 003458E4  7F FF 03 78 */	or r31, r31, r0
/* 80348D08 003458E8  38 60 00 00 */	li r3, 0
/* 80348D0C 003458EC  4B FF E1 69 */	bl EXIUnlock
/* 80348D10 003458F0  7F E0 00 34 */	cntlzw r0, r31
/* 80348D14 003458F4  54 1F D9 7E */	srwi r31, r0, 5
lbl_80348D18:
/* 80348D18 003458F8  93 FE 00 4C */	stw r31, 0x4c(r30)
/* 80348D1C 003458FC  38 00 00 40 */	li r0, 0x40
/* 80348D20 00345900  90 1E 00 40 */	stw r0, 0x40(r30)
/* 80348D24 00345904  80 01 00 1C */	lwz r0, 0x1c(r1)
/* 80348D28 00345908  83 E1 00 14 */	lwz r31, 0x14(r1)
/* 80348D2C 0034590C  83 C1 00 10 */	lwz r30, 0x10(r1)
/* 80348D30 00345910  38 21 00 18 */	addi r1, r1, 0x18
/* 80348D34 00345914  7C 08 03 A6 */	mtlr r0
/* 80348D38 00345918  4E 80 00 20 */	blr 
} // clang-format on
#pragma pop
